# ç ”ç©¶åŸŸæŠ€æœ¯å®ç°æ–‡æ¡£

---

## 1. æ¦‚è¿°

**ç ”ç©¶åŸŸ**ï¼ˆResearch Domainï¼‰æ˜¯ `deepwiki-rs` ç³»ç»Ÿä¸­è´Ÿè´£**é«˜å±‚æ¶æ„çŸ¥è¯†æç‚¼**çš„æ ¸å¿ƒä¸šåŠ¡åŸŸã€‚å®ƒé€šè¿‡å¤šæ™ºèƒ½ä½“ååŒæ¶æ„ï¼Œå°†é¢„å¤„ç†åŸŸè¾“å‡ºçš„åŸå§‹ä»£ç å…ƒæ•°æ®ï¼ˆå¦‚é¡¹ç›®ç»“æ„ã€ä¾èµ–å›¾è°±ã€ä»£ç æ´å¯Ÿï¼‰è½¬åŒ–ä¸ºç»“æ„åŒ–ã€è¯­ä¹‰ä¸°å¯Œçš„**ç³»ç»Ÿçº§ç ”ç©¶æŠ¥å‘Š**ï¼Œä¸ºåç»­æ–‡æ¡£ç¼–æ’æä¾›é«˜è´¨é‡ã€å¯è§£é‡Šçš„è¾“å…¥ã€‚

è¯¥åŸŸä¸ç›´æ¥ç”Ÿæˆæœ€ç»ˆæ–‡æ¡£ï¼Œè€Œæ˜¯ä½œä¸ºâ€œ**æ¶æ„è®¤çŸ¥å¼•æ“**â€ï¼Œå®Œæˆä»â€œä»£ç ç‰‡æ®µâ€åˆ°â€œç³»ç»Ÿè®¤çŸ¥æ¨¡å‹â€çš„å…³é”®è·ƒè¿ã€‚å…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š**é€šè¿‡åˆ†å±‚ã€æœ‰åºã€å¯è¿½æº¯çš„æ™ºèƒ½ä½“æµæ°´çº¿ï¼Œå®ç°å¯¹å¤æ‚ä»£ç åº“çš„è‡ªåŠ¨åŒ–æ¶æ„ç†è§£ä¸çŸ¥è¯†æŠ½è±¡**ã€‚

ç ”ç©¶åŸŸçš„å®ç°éµå¾ªâ€œ**ç¼–æ’å™¨é©±åŠ¨ã€æ™ºèƒ½ä½“è‡ªæ²»ã€ä¸Šä¸‹æ–‡ä¼ é€’**â€çš„è®¾è®¡å“²å­¦ï¼Œæ˜¯ç³»ç»Ÿå®ç°â€œ**æ— éœ€äººå·¥å¹²é¢„çš„è‡ªåŠ¨åŒ–æ¶æ„æ–‡æ¡£ç”Ÿæˆ**â€èƒ½åŠ›çš„åŸºçŸ³ã€‚

---

## 2. æ ¸å¿ƒç»„ä»¶ä¸èŒè´£

ç ”ç©¶åŸŸç”±**ç ”ç©¶ç¼–æ’å™¨**ï¼ˆResearchOrchestratorï¼‰ä¸**äº”ä¸ªç ”ç©¶æ™ºèƒ½ä½“**ï¼ˆResearch Agentsï¼‰ç»„æˆï¼Œå½¢æˆä¸€ä¸ª**å•å‘æµæ°´çº¿å¼åˆ†ææ¡†æ¶**ã€‚å„ç»„ä»¶èŒè´£æ¸…æ™°ã€ä½è€¦åˆï¼Œé€šè¿‡**å†…å­˜å­˜å‚¨åŸŸ**ï¼ˆGeneratorContextï¼‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œå®ç°çŠ¶æ€è§£è€¦ã€‚

| ç»„ä»¶åç§° | ç±»å‹ | èŒè´£ | è¾“å‡ºç‰© | ä¾èµ–è¾“å…¥ |
|----------|------|------|--------|----------|
| **ç ”ç©¶ç¼–æ’å™¨** | æ§åˆ¶å™¨ | åè°ƒæ™ºèƒ½ä½“æ‰§è¡Œé¡ºåºï¼Œç®¡ç†æµç¨‹æ§åˆ¶ä¸é”™è¯¯å¤„ç† | æ— ï¼ˆæµç¨‹æ§åˆ¶ï¼‰ | æ— ï¼ˆä»…è°ƒç”¨ï¼‰ |
| **ç³»ç»Ÿä¸Šä¸‹æ–‡åˆ†æå™¨** | æ™ºèƒ½ä½“ | åˆ†æé¡¹ç›®ç›®æ ‡ã€ç”¨æˆ·ç¾¤ä½“ã€ç³»ç»Ÿè¾¹ç•Œä¸å¤–éƒ¨ä¾èµ– | `SystemContextReport` | `ProjectStructure`, `README`, `CODE_INSIGHTS` |
| **é¢†åŸŸæ¨¡å—æ¢æµ‹å™¨** | æ™ºèƒ½ä½“ | è¯†åˆ«åŠŸèƒ½é¢†åŸŸï¼ˆDomainï¼‰åŠå…¶å†…éƒ¨æ¨¡å—ç»“æ„ | `DomainModulesReport` | `SystemContextReport`, `DEPENDENCY_ANALYSIS`, `CODE_INSIGHTS` |
| **æ¶æ„å›¾ç”Ÿæˆå™¨** | æ™ºèƒ½ä½“ | ç”Ÿæˆ Mermaid æ ¼å¼çš„ç»„ä»¶äº¤äº’å›¾ï¼Œå¯è§†åŒ–æ¨¡å—ä¾èµ– | Mermaid æ¶æ„å›¾å­—ç¬¦ä¸² | `SystemContextReport`, `DomainModulesReport` |
| **å·¥ä½œæµåˆ†æå™¨** | æ™ºèƒ½ä½“ | æå–æ ¸å¿ƒä¸šåŠ¡æµç¨‹ä¸ç”¨æˆ·æ“ä½œè·¯å¾„ | `WorkflowReport` | `SystemContextReport`, `DomainModulesReport`, `CODE_INSIGHTS` |
| **å…³é”®æ¨¡å—æ´å¯Ÿå™¨** | æ™ºèƒ½ä½“ | ä¸ºæ¯ä¸ªé¢†åŸŸæ¨¡å—ç”Ÿæˆæ·±åº¦æŠ€æœ¯æ–‡æ¡£ï¼ŒåŒ…å«å®ç°ç»†èŠ‚ä¸è®¾è®¡å†³ç­– | å¤šä¸ª `KeyModuleReport` | `SystemContextReport`, `DomainModulesReport` |

> âœ… **è®¾è®¡åŸåˆ™**ï¼š  
> - **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ™ºèƒ½ä½“ä»…å…³æ³¨ä¸€ä¸ªåˆ†æç»´åº¦ï¼Œé¿å…åŠŸèƒ½è€¦åˆã€‚  
> - **é¡ºåºä¾èµ–**ï¼šååºæ™ºèƒ½ä½“ä¾èµ–å‰åºæ™ºèƒ½ä½“çš„è¾“å‡ºï¼Œå½¢æˆâ€œå®è§‚â†’ä¸­è§‚â†’å¾®è§‚â€çš„è®¤çŸ¥é€’è¿›ã€‚  
> - **æ— çŠ¶æ€æ§åˆ¶**ï¼šç¼–æ’å™¨ä¸ä¿å­˜åˆ†æçŠ¶æ€ï¼Œæ‰€æœ‰çŠ¶æ€é€šè¿‡ `GeneratorContext` ä¼ é€’ï¼Œæ”¯æŒå¹¶è¡Œæ‰©å±•ä¸æµ‹è¯•ã€‚

---

## 3. æ ¸å¿ƒå®ç°ï¼šç ”ç©¶ç¼–æ’å™¨ï¼ˆResearchOrchestratorï¼‰

### 3.1 ç»“æ„å®šä¹‰

ç ”ç©¶ç¼–æ’å™¨æ˜¯ä¸€ä¸ª**è½»é‡çº§æµç¨‹æ§åˆ¶å™¨**ï¼Œå…¶æ ¸å¿ƒå®ç°ä½äº `src/generator/research/orchestrator.rs`ï¼Œé‡‡ç”¨ Rust ç»“æ„ä½“æ¨¡å¼ï¼Œæ— çŠ¶æ€ã€æ— å‰¯ä½œç”¨ï¼Œä»…è´Ÿè´£è°ƒåº¦ã€‚

```rust
// src/generator/research/orchestrator.rs

use anyhow::Result;
use crate::generator::context::GeneratorContext;
use crate::generator::research::agents::{
    SystemContextResearcher,
    DomainModulesDetector,
    ArchitectureResearcher,
    WorkflowResearcher,
    KeyModulesInsight,
};

pub struct ResearchOrchestrator;

impl ResearchOrchestrator {
    pub async fn execute_research_pipeline(&self, context: &mut GeneratorContext) -> Result<()> {
        println!("ğŸš€ å¼€å§‹æ‰§è¡Œç ”ç©¶æµç¨‹...");

        // 1. å®è§‚å±‚ï¼šç³»ç»Ÿä¸Šä¸‹æ–‡åˆ†æ
        println!("  â†’ æ‰§è¡Œç³»ç»Ÿä¸Šä¸‹æ–‡åˆ†æå™¨...");
        self.execute_agent(SystemContextResearcher {}, context).await?;

        // 2. ä¸­è§‚å±‚ï¼šé¢†åŸŸæ¨¡å—ã€æ¶æ„å›¾ã€å·¥ä½œæµåˆ†æï¼ˆé¡ºåºå¯å¹¶è¡Œï¼Œå½“å‰ä¸ºä¸²è¡Œï¼‰
        println!("  â†’ æ‰§è¡Œé¢†åŸŸæ¨¡å—æ¢æµ‹å™¨...");
        self.execute_agent(DomainModulesDetector {}, context).await?;

        println!("  â†’ æ‰§è¡Œæ¶æ„å›¾ç”Ÿæˆå™¨...");
        self.execute_agent(ArchitectureResearcher {}, context).await?;

        println!("  â†’ æ‰§è¡Œå·¥ä½œæµåˆ†æå™¨...");
        self.execute_agent(WorkflowResearcher {}, context).await?;

        // 3. å¾®è§‚å±‚ï¼šå…³é”®æ¨¡å—æ·±åº¦æ´å¯Ÿ
        println!("  â†’ æ‰§è¡Œå…³é”®æ¨¡å—æ´å¯Ÿå™¨...");
        self.execute_agent(KeyModulesInsight {}, context).await?;

        println!("âœ… ç ”ç©¶æµç¨‹æ‰§è¡Œå®Œæ¯•ã€‚");
        Ok(())
    }

    // æ³›å‹è¾…åŠ©æ–¹æ³•ï¼šç»Ÿä¸€è°ƒç”¨ä»»æ„ StepForwardAgent
    async fn execute_agent<A: StepForwardAgent>(&self, agent: A, context: &mut GeneratorContext) -> Result<()> {
        match agent.execute(context).await {
            Ok(_) => {
                println!("    âœ… {} æ‰§è¡ŒæˆåŠŸ", std::any::type_name::<A>());
                Ok(())
            }
            Err(e) => {
                eprintln!("    âš ï¸ {} æ‰§è¡Œå¤±è´¥: {}", std::any::type_name::<A>(), e);
                // ä¸ä¸­æ–­æµç¨‹ï¼Œä»…è®°å½•æ—¥å¿—ï¼Œç¡®ä¿æ•´ä½“æµç¨‹é²æ£’æ€§
                Ok(())
            }
        }
    }
}
```

### 3.2 å…³é”®æŠ€æœ¯ç‰¹æ€§

| ç‰¹æ€§ | å®ç°æ–¹å¼ | ä»·å€¼ |
|------|----------|------|
| **æ³›å‹è°ƒåº¦** | `execute_agent<A: StepForwardAgent>` | æ”¯æŒä»»æ„å®ç° `StepForwardAgent` çš„æ™ºèƒ½ä½“ï¼Œæ— éœ€ä¿®æ”¹ç¼–æ’å™¨å³å¯æ‰©å±•æ–°åˆ†ææ¨¡å— |
| **ç»Ÿä¸€é”™è¯¯å¤„ç†** | `match agent.execute(...).await` + `anyhow::Error` æ•è· | å•ä¸ªæ™ºèƒ½ä½“å¤±è´¥ä¸å½±å“æ•´ä½“æµç¨‹ï¼Œæå‡ç³»ç»Ÿå®¹é”™æ€§ |
| **å¯è§‚æµ‹æ€§å¢å¼º** | `println!` æ—¥å¿—è¾“å‡º | ä¾¿äºè°ƒè¯•ã€æ—¥å¿—è¿½è¸ªä¸ç”¨æˆ·æ„ŸçŸ¥æµç¨‹è¿›åº¦ï¼Œç¬¦åˆ CLI å·¥å…·é¢„æœŸ |
| **å¼‚æ­¥éé˜»å¡** | `async/await` + `tokio` | æ”¯æŒæœªæ¥æ™ºèƒ½ä½“å†…éƒ¨å¹¶å‘è°ƒç”¨ LLMï¼Œæå‡ååé‡ |
| **é›¶ä¸šåŠ¡é€»è¾‘** | ä»…è°ƒç”¨ `execute()`ï¼Œæ— è§£æã€æ— åˆ¤æ–­ã€æ— è½¬æ¢ | ç¬¦åˆâ€œæ§åˆ¶æµä¸ä¸šåŠ¡æµåˆ†ç¦»â€åŸåˆ™ï¼Œæ˜“äºå•å…ƒæµ‹è¯•ä¸å¤ç”¨ |

### 3.3 æ¥å£å¥‘çº¦ï¼š`StepForwardAgent`

æ‰€æœ‰ç ”ç©¶æ™ºèƒ½ä½“å¿…é¡»å®ç°ä»¥ä¸‹ç»Ÿä¸€æ¥å£ï¼Œç¡®ä¿ç¼–æ’å™¨çš„é€šç”¨æ€§ï¼š

```rust
// src/generator/research/mod.rs

use crate::generator::context::GeneratorContext;
use anyhow::Result;

pub trait StepForwardAgent {
    async fn execute(&self, context: &mut GeneratorContext) -> Result<()>;
}
```

> âœ… **å¥‘çº¦æ„ä¹‰**ï¼š  
> æ‰€æœ‰æ™ºèƒ½ä½“ä»…é€šè¿‡ `context` è·å–è¾“å…¥ã€å†™å…¥è¾“å‡ºï¼Œ**ä¸ä¾èµ–å…¨å±€å˜é‡ã€å•ä¾‹æˆ–æ–‡ä»¶ç³»ç»Ÿ**ï¼Œå®ç°**å®Œå…¨å¯æµ‹è¯•ã€å¯æ¨¡æ‹Ÿã€å¯æ›¿æ¢**ã€‚

---

## 4. æ™ºèƒ½ä½“æ‰§è¡Œæµç¨‹ä¸æ•°æ®ä¾èµ–

ç ”ç©¶åŸŸçš„æ‰§è¡Œæµç¨‹ä¸¥æ ¼éµå¾ª**å±‚æ¬¡åŒ–ä¾èµ–æ¨¡å‹**ï¼Œæ•°æ®æµå‘ˆâ€œ**æ ‘çŠ¶ä¼ é€’ã€é€å±‚æ·±åŒ–**â€ç‰¹å¾ã€‚

### 4.1 æ‰§è¡Œé¡ºåºä¸æ•°æ®ä¾èµ–å›¾

```mermaid
graph LR
    A[é¢„å¤„ç†åŸŸ] -->|æä¾›| B[ProjectStructure]
    A -->|æä¾›| C[CODE_INSIGHTS]
    A -->|æä¾›| D[DEPENDENCY_ANALYSIS]
    A -->|æä¾›| E[README]

    B --> F[ç³»ç»Ÿä¸Šä¸‹æ–‡åˆ†æå™¨]
    C --> F
    D --> F
    E --> F

    F --> G[SystemContextReport]

    G --> H[é¢†åŸŸæ¨¡å—æ¢æµ‹å™¨]
    C --> H
    D --> H

    H --> I[DomainModulesReport]

    G --> J[æ¶æ„å›¾ç”Ÿæˆå™¨]
    I --> J

    J --> K[Mermaidæ¶æ„å›¾]

    G --> L[å·¥ä½œæµåˆ†æå™¨]
    H --> L
    C --> L

    L --> M[WorkflowReport]

    G --> N[å…³é”®æ¨¡å—æ´å¯Ÿå™¨]
    I --> N

    N --> O[KeyModuleReport1, KeyModuleReport2, ...]

    G --> P[å­˜å‚¨åˆ°å†…å­˜]
    I --> P
    K --> P
    M --> P
    O --> P
```

### 4.2 æ•°æ®æµè¯¦è§£ï¼ˆåŸºäº Sequence Diagramï¼‰

```mermaid
sequenceDiagram
    participant Orchestrator
    participant SystemContextResearcher
    participant DomainModulesDetector
    participant ArchitectureResearcher
    participant WorkflowResearcher
    participant KeyModulesInsight
    participant GeneratorContext

    Orchestrator->>SystemContextResearcher: execute(context)
    SystemContextResearcher->>GeneratorContext: get(ProjectStructure, README, CODE_INSIGHTS)
    GeneratorContext-->>SystemContextResearcher: è¿”å›æ•°æ®
    SystemContextResearcher->>GeneratorContext: store(SystemContextReport)
    
    Orchestrator->>DomainModulesDetector: execute(context)
    DomainModulesDetector->>GeneratorContext: get(SystemContextReport, DEPENDENCY_ANALYSIS, CODE_INSIGHTS)
    GeneratorContext-->>DomainModulesDetector: è¿”å›æ•°æ®
    DomainModulesDetector->>GeneratorContext: store(DomainModulesReport)
    
    Orchestrator->>ArchitectureResearcher: execute(context)
    ArchitectureResearcher->>GeneratorContext: get(SystemContextReport, DomainModulesReport)
    GeneratorContext-->>ArchitectureResearcher: è¿”å›æ•°æ®
    ArchitectureResearcher->>GeneratorContext: store(architecture_mermaid)
    
    Orchestrator->>WorkflowResearcher: execute(context)
    WorkflowResearcher->>GeneratorContext: get(SystemContextReport, DomainModulesReport, CODE_INSIGHTS)
    GeneratorContext-->>WorkflowResearcher: è¿”å›æ•°æ®
    WorkflowResearcher->>GeneratorContext: store(WorkflowReport)
    
    Orchestrator->>KeyModulesInsight: execute(context)
    KeyModulesInsight->>GeneratorContext: get(SystemContextReport, DomainModulesReport)
    GeneratorContext-->>KeyModulesInsight: è¿”å›æ•°æ®
    KeyModulesInsight->>GeneratorContext: store(KeyModuleReport_*, KeyModuleReport_*)
```

> ğŸ” **å…³é”®è§‚å¯Ÿ**ï¼š
> - æ‰€æœ‰æ™ºèƒ½ä½“**ä»…è¯»å–** `GeneratorContext`ï¼Œ**ä¸ä¿®æ”¹**å…¶ä»–æ™ºèƒ½ä½“çš„è¾“å‡ºã€‚
> - æ‰€æœ‰è¾“å‡ºå‡**å†™å…¥å†…å­˜**ï¼Œç”± `GeneratorContext` ç»Ÿä¸€ç®¡ç†ä½œç”¨åŸŸï¼ˆ`STUDIES_RESEARCH`ï¼‰ã€‚
> - **æ— ç›´æ¥é€šä¿¡**ï¼Œæ‰€æœ‰äº¤äº’é€šè¿‡â€œå†…å­˜æ€»çº¿â€å®Œæˆï¼Œå®ç°**é«˜å†…èšã€ä½è€¦åˆ**ã€‚

---

## 5. æ™ºèƒ½ä½“å®ç°ç¤ºä¾‹ï¼šé¢†åŸŸæ¨¡å—æ¢æµ‹å™¨ï¼ˆDomainModulesDetectorï¼‰

ä¸ºä½“ç°æ™ºèƒ½ä½“çš„å®ç°è§„èŒƒï¼Œä»¥ä¸‹ä¸º `DomainModulesDetector` çš„å…¸å‹å®ç°ï¼š

```rust
// src/generator/research/agents/domain_modules_detector.rs

use crate::generator::context::GeneratorContext;
use crate::generator::research::types::{DomainModulesReport, DomainModule};
use crate::llm::client::StepForwardAgent;
use anyhow::Result;

pub struct DomainModulesDetector;

impl DomainModulesDetector {
    pub fn data_config(&self) -> serde_json::Value {
        serde_json::json!({
            "prompt_template": "åŸºäºä»¥ä¸‹é¡¹ç›®ç»“æ„ã€ä¾èµ–å…³ç³»å’Œä»£ç æ´å¯Ÿï¼Œè¯†åˆ«å‡ºé¡¹ç›®ä¸­çš„åŠŸèƒ½é¢†åŸŸï¼ˆDomainï¼‰åŠå…¶åŒ…å«çš„æ¨¡å—ã€‚è¯·ä»¥ JSON æ ¼å¼è¾“å‡ºï¼Œæ¯ä¸ªé¢†åŸŸåŒ…å« nameã€description å’Œ modulesï¼ˆæ¨¡å—åˆ—è¡¨ï¼‰ã€‚ä¸è¦è§£é‡Šï¼Œä»…è¾“å‡º JSONã€‚",
            "required_fields": ["name", "description", "modules"]
        })
    }

    pub fn prompt_template(&self) -> &'static str {
        r#"è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯è¯†åˆ«ç³»ç»Ÿä¸­çš„åŠŸèƒ½é¢†åŸŸï¼š

é¡¹ç›®ç»“æ„ï¼š
{project_structure}

ä¾èµ–åˆ†æï¼š
{dependency_analysis}

ä»£ç æ´å¯Ÿï¼š
{code_insights}

è¯·è¾“å‡ºä¸€ä¸ª JSON æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ ä»£è¡¨ä¸€ä¸ªåŠŸèƒ½é¢†åŸŸï¼ŒåŒ…å«ï¼š
- name: é¢†åŸŸåç§°ï¼ˆå¦‚ "ç”¨æˆ·è®¤è¯"ï¼‰
- description: é¢†åŸŸæè¿°ï¼ˆ1-2å¥è¯ï¼‰
- modules: æ¨¡å—åç§°åˆ—è¡¨ï¼ˆå¦‚ ["auth_service", "token_manager", "login_handler"]ï¼‰

ä»…è¾“å‡º JSONï¼Œä¸è¦ä»»ä½•é¢å¤–æ–‡æœ¬ã€‚"#
    }
}

impl StepForwardAgent for DomainModulesDetector {
    async fn execute(&self, context: &mut GeneratorContext) -> Result<()> {
        let project_structure = context.get::<serde_json::Value>("PROJECT_STRUCTURE")?;
        let dependency_analysis = context.get::<serde_json::Value>("DEPENDENCY_ANALYSIS")?;
        let code_insights = context.get::<serde_json::Value>("CODE_INSIGHTS")?;

        let prompt = self.prompt_template()
            .replace("{project_structure}", &project_structure.to_string())
            .replace("{dependency_analysis}", &dependency_analysis.to_string())
            .replace("{code_insights}", &code_insights.to_string());

        let llm_response = context.llm_client().execute_prompt(prompt).await?;

        let domain_modules: DomainModulesReport = serde_json::from_str(&llm_response)
            .map_err(|e| anyhow::anyhow!("è§£æé¢†åŸŸæ¨¡å—JSONå¤±è´¥: {}", e))?;

        context.store("DomainModulesReport", &domain_modules)?;

        Ok(())
    }
}
```

### 5.1 å®ç°è¦ç‚¹

| è¦ç‚¹ | è¯´æ˜ |
|------|------|
| **æç¤ºå·¥ç¨‹åˆ†ç¦»** | `prompt_template()` ä¸ `data_config()` æ–¹æ³•å°†æç¤ºè¯ä¸é…ç½®é€»è¾‘ç‹¬ç«‹ï¼Œä¾¿äºç»´æŠ¤ä¸æµ‹è¯• |
| **ç±»å‹å®‰å…¨** | ä½¿ç”¨ `context.get<T>()` å’Œ `context.store<T>()` ç¡®ä¿æ•°æ®ç±»å‹ä¸€è‡´æ€§ |
| **LLM è°ƒç”¨æŠ½è±¡** | é€šè¿‡ `context.llm_client()` è·å–ç»Ÿä¸€ LLM å®¢æˆ·ç«¯ï¼Œå¤ç”¨ç¼“å­˜ä¸ ReAct èƒ½åŠ› |
| **é”™è¯¯å¤„ç†** | JSON è§£æå¤±è´¥æ—¶è¿”å›æ˜ç¡®é”™è¯¯ï¼Œä½†ä¸ä¸­æ–­æ•´ä½“æµç¨‹ |
| **è¾“å‡ºæ ‡å‡†åŒ–** | è¾“å‡ºä¸º `DomainModulesReport` ç»“æ„ä½“ï¼Œè€ŒéåŸå§‹å­—ç¬¦ä¸²ï¼Œä¾¿äºä¸‹æ¸¸æ¶ˆè´¹ |

---

## 6. é”™è¯¯å¤„ç†ä¸å®¹é”™æœºåˆ¶

ç ”ç©¶åŸŸé‡‡ç”¨**â€œå¤±è´¥å®¹å¿â€**ï¼ˆFail-Softï¼‰ç­–ç•¥ï¼Œç¡®ä¿**å•ç‚¹æ•…éšœä¸é˜»æ–­æ•´ä½“æµç¨‹**ï¼š

- **é€å±‚ try-catch**ï¼šæ¯ä¸ªæ™ºèƒ½ä½“çš„ `execute()` è¢« `execute_agent()` åŒ…è£¹ï¼Œæ•è· `anyhow::Error`ã€‚
- **æ—¥å¿—è®°å½•**ï¼šå¤±è´¥æ—¶è¾“å‡ºæ™ºèƒ½ä½“åç§°ä¸é”™è¯¯è¯¦æƒ…ï¼Œä¾¿äºäº‹ååˆ†æã€‚
- **ç»§ç»­æ‰§è¡Œ**ï¼šå³ä½¿ `ArchitectureResearcher` ç”Ÿæˆ Mermaid å›¾å¤±è´¥ï¼Œ`KeyModulesInsight` ä»å¯ç»§ç»­è¿è¡Œã€‚
- **ç»“æœå®Œæ•´æ€§**ï¼šæœ€ç»ˆè¾“å‡ºä¸­ï¼Œå¤±è´¥æ¨¡å—çš„æŠ¥å‘Šä¸ºç©ºæˆ–ç¼ºå¤±ï¼Œä½†å…¶ä»–æ¨¡å—æŠ¥å‘Šå®Œæ•´ã€‚

> ğŸ’¡ **è®¾è®¡å“²å­¦**ï¼š  
> â€œ**å®å¯éƒ¨åˆ†ç¼ºå¤±ï¼Œä¸å¯æ•´ä½“å´©æºƒ**â€ â€”â€” åœ¨ AI é©±åŠ¨çš„éç¡®å®šæ€§ç³»ç»Ÿä¸­ï¼Œé²æ£’æ€§ä¼˜å…ˆäºå®Œç¾æ€§ã€‚

---

## 7. æ€§èƒ½ä¸æ‰©å±•æ€§è®¾è®¡

### 7.1 ç¼“å­˜å¤ç”¨

æ‰€æœ‰æ™ºèƒ½ä½“å‡é€šè¿‡ `GeneratorContext.llm_client()` è°ƒç”¨ LLMï¼Œ**è‡ªåŠ¨å¤ç”¨ç¼“å­˜åŸŸ**ï¼ˆCacheManagerï¼‰ï¼š

- **Prompt å“ˆå¸Œç¼“å­˜**ï¼šç›¸åŒæç¤ºè¯ï¼ˆå«ä¸Šä¸‹æ–‡ï¼‰å‘½ä¸­ç¼“å­˜ï¼Œé¿å…é‡å¤è°ƒç”¨ã€‚
- **Token æˆæœ¬èŠ‚çœ**ï¼šåœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œç¼“å­˜å‘½ä¸­ç‡å¯è¾¾ 60%+ï¼Œæ˜¾è‘—é™ä½ LLM æˆæœ¬ã€‚
- **æ€§èƒ½ç›‘æ§**ï¼š`PerformanceMonitor` è‡ªåŠ¨è®°å½•æ¯ä¸ªæ™ºèƒ½ä½“çš„ç¼“å­˜å‘½ä¸­/æœªå‘½ä¸­äº‹ä»¶ã€‚

### 7.2 æ‰©å±•æ€§æ”¯æŒ

| æ‰©å±•æ–¹å¼ | å®ç°æ–¹å¼ |
|----------|----------|
| **æ–°å¢æ™ºèƒ½ä½“** | å®ç° `StepForwardAgent`ï¼Œæ³¨å†Œåˆ° `execute_research_pipeline` ä¸­å³å¯ |
| **è°ƒæ•´é¡ºåº** | ä¿®æ”¹ `orchestrator.rs` ä¸­çš„è°ƒç”¨é¡ºåºï¼Œæ— éœ€ä¿®æ”¹æ™ºèƒ½ä½“ |
| **æ›¿æ¢æ™ºèƒ½ä½“** | æ›¿æ¢ `execute_agent(...)` ä¸­çš„å®ä¾‹ï¼Œå¦‚ç”¨ `AdvancedDomainDetector` æ›¿ä»£ `DomainModulesDetector` |
| **å¹¶è¡ŒåŒ–** | æœªæ¥å¯å°†ä¸­è§‚å±‚ï¼ˆé¢†åŸŸã€æ¶æ„ã€å·¥ä½œæµï¼‰æ”¹ä¸º `join_all()` å¹¶è¡Œæ‰§è¡Œï¼Œæå‡æ•ˆç‡ |

> âœ… **æ‰©å±•ç¤ºä¾‹**ï¼š  
> è‹¥éœ€å¢åŠ â€œæŠ€æœ¯å€ºè¯„ä¼°æ™ºèƒ½ä½“â€ï¼Œåªéœ€ï¼š
> ```rust
> // åœ¨ orchestrator.rs ä¸­æ·»åŠ ï¼š
> println!("  â†’ æ‰§è¡ŒæŠ€æœ¯å€ºè¯„ä¼°...");
> self.execute_agent(TechnicalDebtAssessor {}, context).await?;
> ```

---

## 8. ä¸å…¶ä»–åŸŸçš„äº¤äº’å…³ç³»

| äº¤äº’æ–¹å‘ | äº¤äº’å†…å®¹ | ä¾èµ–ç±»å‹ | é‡è¦æ€§ |
|----------|----------|----------|--------|
| **â† é¢„å¤„ç†åŸŸ** | è·å– `ProjectStructure`, `CODE_INSIGHTS`, `DEPENDENCY_ANALYSIS` | æ•°æ®ä¾èµ– | â­â­â­â­â­ |
| **â† å†…å­˜å­˜å‚¨åŸŸ** | é€šè¿‡ `GeneratorContext` è¯»å†™ç»“æ„åŒ–æ•°æ® | æ•°æ®é€šé“ | â­â­â­â­â­ |
| **â†’ LLMå®¢æˆ·ç«¯åŸŸ** | è°ƒç”¨ `execute_prompt()` è¿›è¡Œè¯­ä¹‰æ¨ç† | æœåŠ¡è°ƒç”¨ | â­â­â­â­â­ |
| **â†’ ç¼“å­˜åŸŸ** | é€šè¿‡ LLM å®¢æˆ·ç«¯é—´æ¥ä½¿ç”¨ç¼“å­˜ | å·¥å…·æ”¯æ’‘ | â­â­â­â­ |
| **â†’ æ–‡æ¡£ç¼–æ’åŸŸ** | æä¾› `SystemContextReport`, `DomainModulesReport` ç­‰ä½œä¸ºè¾“å…¥ | æ•°æ®ä¾èµ– | â­â­â­â­â­ |

> ğŸ“Œ **å…³é”®è®¾è®¡**ï¼š  
> ç ”ç©¶åŸŸ**ä¸ç›´æ¥ä¾èµ–æ–‡ä»¶ç³»ç»Ÿã€é…ç½®ã€å·¥å…·åº“**ï¼Œæ‰€æœ‰å¤–éƒ¨ä¾èµ–å‡é€šè¿‡ `GeneratorContext` æŠ½è±¡ï¼Œå®ç°**å®Œå…¨å¯æµ‹è¯•**ã€‚

---

## 9. æµ‹è¯•ä¸å¯éªŒè¯æ€§

ç ”ç©¶åŸŸå…·å¤‡**æä½³çš„å¯æµ‹è¯•æ€§**ï¼š

| æµ‹è¯•ç±»å‹ | å®ç°æ–¹å¼ |
|----------|----------|
| **å•å…ƒæµ‹è¯•** | æ¨¡æ‹Ÿ `GeneratorContext`ï¼Œæ³¨å…¥é¢„è®¾æ•°æ®ï¼ŒéªŒè¯æ™ºèƒ½ä½“è¾“å‡ºæ˜¯å¦ç¬¦åˆé¢„æœŸ |
| **é›†æˆæµ‹è¯•** | ä½¿ç”¨çœŸå® `LLMClient`ï¼ˆMockï¼‰æ‰§è¡Œå®Œæ•´æµæ°´çº¿ï¼ŒéªŒè¯æ•°æ®æµå®Œæ•´æ€§ |
| **ç«¯åˆ°ç«¯æµ‹è¯•** | åœ¨æµ‹è¯•é¡¹ç›®ä¸Šè¿è¡Œ CLIï¼ŒéªŒè¯ `DomainModulesReport` æ˜¯å¦ç”Ÿæˆ |
| **æ—¥å¿—éªŒè¯** | é€šè¿‡ `std::io::stdout().lock()` æ•è· `println!` è¾“å‡ºï¼ŒéªŒè¯æµç¨‹é¡ºåº |

```rust
// ç¤ºä¾‹ï¼šæµ‹è¯•é¢†åŸŸæ¨¡å—æ¢æµ‹å™¨
#[tokio::test]
async fn test_domain_modules_detector() {
    let mut context = GeneratorContext::new();
    context.store("PROJECT_STRUCTURE", &json!({ "files": ["src/auth.rs"] })).unwrap();
    context.store("DEPENDENCY_ANALYSIS", &json!({ "dependencies": ["tokio", "serde"] })).unwrap();
    context.store("CODE_INSIGHTS", &json!({ "functions": ["login", "logout"] })).unwrap();

    let detector = DomainModulesDetector {};
    detector.execute(&mut context).await.unwrap();

    let report: DomainModulesReport = context.get("DomainModulesReport").unwrap();
    assert_eq!(report.domains.len(), 1);
    assert_eq!(report.domains[0].name, "ç”¨æˆ·è®¤è¯");
}
```

---

## 10. æ€»ç»“ï¼šç ”ç©¶åŸŸçš„æ ¸å¿ƒä»·å€¼

| ç»´åº¦ | ç ”ç©¶åŸŸçš„è´¡çŒ® |
|------|--------------|
| **è®¤çŸ¥æŠ½è±¡** | å°†ä»£ç ç‰‡æ®µè½¬åŒ–ä¸ºâ€œç³»ç»Ÿä¸Šä¸‹æ–‡â€ã€â€œé¢†åŸŸæ¨¡å—â€ã€â€œå·¥ä½œæµâ€ç­‰æ¶æ„æ¦‚å¿µ |
| **æµç¨‹æ ‡å‡†åŒ–** | å»ºç«‹â€œå®è§‚â†’ä¸­è§‚â†’å¾®è§‚â€çš„åˆ†æèŒƒå¼ï¼Œç¡®ä¿åˆ†æä¸€è‡´æ€§ |
| **çŸ¥è¯†æ²‰æ·€** | è¾“å‡ºç»“æ„åŒ–æŠ¥å‘Šï¼Œä¸ºæ–‡æ¡£ç¼–æ’æä¾›â€œå¯å¤ç”¨çš„çŸ¥è¯†å•å…ƒâ€ |
| **æˆæœ¬æ§åˆ¶** | é€šè¿‡ç¼“å­˜ä¸æ™ºèƒ½ä½“å¤ç”¨ï¼Œé™ä½ LLM è°ƒç”¨é¢‘æ¬¡ä¸æˆæœ¬ |
| **ç³»ç»Ÿå¼¹æ€§** | å•ç‚¹å¤±è´¥ä¸å½±å“æ•´ä½“ï¼Œæ”¯æŒåŠ¨æ€æ‰©å±•ä¸æ›¿æ¢ |
| **å·¥ç¨‹å…¸èŒƒ** | å±•ç¤ºäº†å¦‚ä½•åœ¨ Rust ä¸­æ„å»º**é«˜å†…èšã€ä½è€¦åˆã€å¯æµ‹è¯•ã€å¯æ‰©å±•**çš„å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ |

> âœ… **ç»“è®º**ï¼š  
> **ç ”ç©¶åŸŸæ˜¯ deepwiki-rs çš„â€œå¤§è„‘â€**ã€‚å®ƒä¸ç”Ÿæˆæ–‡æ¡£ï¼Œä½†å®ƒå†³å®šäº†æ–‡æ¡£çš„**æ·±åº¦ã€å‡†ç¡®æ€§ä¸å®Œæ•´æ€§**ã€‚æ²¡æœ‰å®ƒï¼Œç³»ç»Ÿåªæ˜¯ä»£ç çš„â€œå¤å°æœºâ€ï¼›æœ‰äº†å®ƒï¼Œç³»ç»Ÿæˆä¸ºæ¶æ„çš„â€œç†è§£è€…â€ã€‚

---

## é™„å½•ï¼šç ”ç©¶åŸŸæ ¸å¿ƒæ–‡ä»¶æ¸…å•

| æ–‡ä»¶è·¯å¾„ | è¯´æ˜ |
|----------|------|
| `src/generator/research/orchestrator.rs` | ç ”ç©¶ç¼–æ’å™¨ä¸»å®ç° |
| `src/generator/research/agents/` | æ‰€æœ‰ç ”ç©¶æ™ºèƒ½ä½“å®ç°ç›®å½• |
| `src/generator/research/types.rs` | `SystemContextReport`, `DomainModulesReport`, `KeyModuleReport` ç­‰æ•°æ®æ¨¡å‹ |
| `src/generator/research/memory.rs` | ç ”ç©¶é˜¶æ®µå†…å­˜é”®åå¸¸é‡ï¼ˆå¦‚ `STUDIES_RESEARCH`ï¼‰ |
| `src/generator/context.rs` | `GeneratorContext` ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆæ‰€æœ‰æ™ºèƒ½ä½“ä¾èµ–ï¼‰ |
| `src/generator/research/mod.rs` | æ¨¡å—å…¥å£ï¼Œæš´éœ² `StepForwardAgent` æ¥å£ |

---

> ğŸ“ **å»ºè®®**ï¼šå°†æœ¬æŠ€æœ¯æ–‡æ¡£åµŒå…¥é¡¹ç›® `docs/architecture/research-domain.md`ï¼Œå¹¶é…åˆ `src/generator/research/orchestrator.rs` çš„æ³¨é‡Šï¼Œä½œä¸ºå›¢é˜ŸçŸ¥è¯†æ²‰æ·€çš„æ ¸å¿ƒèµ„äº§ã€‚