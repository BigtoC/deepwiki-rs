# å†…å­˜å­˜å‚¨åŸŸæŠ€æœ¯å®ç°æ–‡æ¡£

---

## **å†…å­˜å­˜å‚¨åŸŸï¼šé€šç”¨å†…å­˜é”®å€¼å­˜å‚¨ç³»ç»Ÿ**

### **1. æ¦‚è¿°**

**å†…å­˜å­˜å‚¨åŸŸ**ï¼ˆMemory Storage Domainï¼‰æ˜¯ `deepwiki-rs` ç³»ç»Ÿçš„æ ¸å¿ƒåŸºç¡€è®¾æ–½ä¹‹ä¸€ï¼Œä½œä¸º**è·¨æ¨¡å—æ•°æ®äº¤æ¢çš„å”¯ä¸€ç»Ÿä¸€é€šé“**ï¼Œæ‰¿æ‹…ç€åœ¨é¢„å¤„ç†ã€ç ”ç©¶ã€æ–‡æ¡£ç¼–æ’ä¸è¾“å‡ºå››å¤§æ ¸å¿ƒä¸šåŠ¡åŸŸä¹‹é—´ä¼ é€’ç»“æ„åŒ–è¯­ä¹‰æ•°æ®çš„é‡ä»»ã€‚è¯¥åŸŸé€šè¿‡é«˜æ€§èƒ½ã€æ— æŒä¹…åŒ–çš„å†…å­˜é”®å€¼å­˜å‚¨ï¼Œå®ç°äº†æ™ºèƒ½ä½“ä¹‹é—´çš„**å¼‚æ­¥è§£è€¦åä½œ**ï¼Œæ˜¯ç³»ç»Ÿå®ç°â€œ**é«˜å†…èšã€ä½è€¦åˆã€å¯æ‰©å±•**â€å¤šæ™ºèƒ½ä½“æ¶æ„çš„åŸºçŸ³ã€‚

> âœ… **æ ¸å¿ƒä»·å€¼**ï¼š  
> æ¶ˆé™¤æ¨¡å—é—´ç›´æ¥ä¾èµ–ï¼Œå®ç°â€œç”Ÿäº§è€…-æ¶ˆè´¹è€…â€æ¨¡å¼çš„æ•°æ®æµï¼›  
> ä¸ºLLMæ™ºèƒ½ä½“æä¾›ä¸€è‡´ã€å¯è¿½æº¯çš„ä¸Šä¸‹æ–‡è¾“å…¥ï¼›  
> æ”¯æŒè·¨é˜¶æ®µæ•°æ®å¤ç”¨ï¼Œé¿å…é‡å¤åˆ†æï¼Œæå‡ç³»ç»Ÿæ•´ä½“æ•ˆç‡ã€‚

è¯¥åŸŸç”± `src/memory/mod.rs` å®ç°ï¼Œå¯¹å¤–æä¾› `store`ã€`get`ã€`list_keys`ã€`has_data`ã€`get_usage_stats` ç­‰æ ‡å‡†æ¥å£ï¼Œå†…éƒ¨é‡‡ç”¨ `HashMap<full_key, serde_json::Value>` ä½œä¸ºæ ¸å¿ƒæ•°æ®ç»“æ„ï¼Œç»“åˆå…ƒæ•°æ®ç®¡ç†æœºåˆ¶ï¼Œå®ç°å¯¹ä»»æ„å¯åºåˆ—åŒ–æ•°æ®çš„æ³›å‹å­˜å‚¨ä¸è®¿é—®æ§åˆ¶ã€‚

---

### **2. æ¶æ„è®¾è®¡åŸåˆ™**

| åŸåˆ™ | è¯´æ˜ |
|------|------|
| **å•ä¸€æ•°æ®æ€»çº¿** | æ‰€æœ‰æ¨¡å—ï¼ˆé¢„å¤„ç†ã€ç ”ç©¶ã€ç¼–æ’ã€è¾“å‡ºï¼‰ä»…é€šè¿‡å†…å­˜å­˜å‚¨åŸŸäº¤æ¢æ•°æ®ï¼Œç¦æ­¢ç›´æ¥å¼•ç”¨æˆ–ä¼ é€’ç»“æ„ä½“ï¼Œç¡®ä¿è§£è€¦ã€‚ |
| **ä½œç”¨åŸŸéš”ç¦»** | ä½¿ç”¨ `scope:key` æ ¼å¼é”®åï¼Œå®ç°é€»è¾‘å‘½åç©ºé—´éš”ç¦»ï¼Œé¿å…ä¸åŒæ¨¡å—é—´é”®å†²çªï¼ˆå¦‚ `preprocess:code_insights` ä¸ `research:system_context`ï¼‰ã€‚ |
| **åºåˆ—åŒ–ä¸­ç«‹** | æ•°æ®ä»¥ `serde_json::Value` å­˜å‚¨ï¼Œæ”¯æŒä»»æ„ Rust ç»“æ„ä½“ï¼ˆé€šè¿‡ `Serialize`/`Deserialize`ï¼‰ï¼Œä¸ç»‘å®šå…·ä½“ç±»å‹ï¼Œæå‡çµæ´»æ€§ã€‚ |
| **å…ƒæ•°æ®é©±åŠ¨** | æ¯æ¬¡è¯»å†™å‡æ›´æ–°è®¿é—®è®¡æ•°ã€æ•°æ®å¤§å°ã€æ—¶é—´æˆ³ç­‰å…ƒä¿¡æ¯ï¼Œä¸ºæ€§èƒ½ç›‘æ§ã€ç¼“å­˜ä¼˜åŒ–ã€èµ„æºåˆ†ææä¾›æ•°æ®æ”¯æ’‘ã€‚ |
| **åŒæ­¥æ¥å£ï¼Œå¼‚æ­¥å°è£…** | å†…éƒ¨å®ç°ä¸ºåŒæ­¥æ–¹æ³•ï¼Œç”± `GeneratorContext` å°è£…ä¸ºå¼‚æ­¥æ¥å£ï¼Œé€‚é…å¼‚æ­¥æ™ºèƒ½ä½“æ‰§è¡Œç¯å¢ƒï¼ˆå¦‚ `tokio`ï¼‰ã€‚ |
| **é›¶æŒä¹…åŒ–** | æ‰€æœ‰æ•°æ®é©»ç•™å†…å­˜ï¼Œç”Ÿå‘½å‘¨æœŸä¸è¿›ç¨‹ä¸€è‡´ï¼Œé¿å… I/O å»¶è¿Ÿï¼Œç¡®ä¿é«˜é¢‘è¯»å†™æ€§èƒ½ã€‚ |

---

### **3. æ ¸å¿ƒç»„ä»¶ä¸æ•°æ®ç»“æ„**

#### **3.1 ä¸»è¦ç»“æ„ä½“**

```rust
// src/memory/mod.rs

use serde_json::Value;
use std::collections::HashMap;
use std::time::SystemTime;

#[derive(Debug, Default)]
pub struct MemoryMetadata {
    pub created_at: SystemTime,
    pub last_updated: SystemTime,
    pub access_counts: HashMap<String, u64>,     // full_key -> è®¿é—®æ¬¡æ•°
    pub data_sizes: HashMap<String, usize>,      // full_key -> åºåˆ—åŒ–åå­—èŠ‚å¤§å°
    pub total_size: usize,                       // æ‰€æœ‰æ•°æ®æ€»å­—èŠ‚æ•°
}

#[derive(Debug, Default)]
pub struct Memory {
    data: HashMap<String, Value>,                // æ ¸å¿ƒé”®å€¼å­˜å‚¨
    metadata: MemoryMetadata,
}
```

- **`Memory`**ï¼šä¸»å­˜å‚¨å®¹å™¨ï¼Œå°è£… `data`ï¼ˆé”®å€¼å¯¹ï¼‰ä¸ `metadata`ï¼ˆç»Ÿè®¡å…ƒä¿¡æ¯ï¼‰ã€‚
- **`MemoryMetadata`**ï¼šç»´æŠ¤ç³»ç»Ÿçº§è¿è¡Œæ—¶ç»Ÿè®¡ä¿¡æ¯ï¼Œç”¨äºèµ„æºç›‘æ§ä¸æ€§èƒ½åˆ†æã€‚

#### **3.2 é”®å‘½åè§„èŒƒ**

æ‰€æœ‰é”®é‡‡ç”¨ **`scope:key`** æ ¼å¼ï¼Œç¡®ä¿å…¨å±€å”¯ä¸€æ€§ä¸è¯­ä¹‰æ¸…æ™°ï¼š

| ç¤ºä¾‹é”® | ä½œç”¨åŸŸ | ç”¨é€” |
|--------|--------|------|
| `preprocess:project_structure` | é¢„å¤„ç†åŸŸ | å­˜å‚¨é¡¹ç›®æ–‡ä»¶æ ‘ç»“æ„ |
| `preprocess:code_insights` | é¢„å¤„ç†åŸŸ | å­˜å‚¨AIç”Ÿæˆçš„ä»£ç æ´å¯Ÿ |
| `research:system_context` | ç ”ç©¶åŸŸ | å­˜å‚¨ç³»ç»Ÿä¸Šä¸‹æ–‡æŠ¥å‘Š |
| `research:domain_modules` | ç ”ç©¶åŸŸ | å­˜å‚¨é¢†åŸŸæ¨¡å—æ¢æµ‹ç»“æœ |
| `compose:overview_doc` | æ–‡æ¡£ç¼–æ’åŸŸ | å­˜å‚¨é¡¹ç›®æ¦‚è¿°Markdown |
| `compose:architecture_diagram` | æ–‡æ¡£ç¼–æ’åŸŸ | å­˜å‚¨Mermaidæ¶æ„å›¾ |

> ğŸ” **è®¾è®¡ä¼˜åŠ¿**ï¼š  
> - é€šè¿‡å‰ç¼€åŒ¹é…ï¼ˆ`scope:`ï¼‰å¯é«˜æ•ˆè¿‡æ»¤ã€èšåˆã€æ¸…ç†æ•°æ®ï¼›  
> - åœ¨ `get_usage_stats()` ä¸­å¯æŒ‰ä½œç”¨åŸŸç»Ÿè®¡å†…å­˜å ç”¨ï¼Œè¾…åŠ©èµ„æºåˆ†æï¼›  
> - ä¸ `src/generator/research/memory.rs`ã€`src/generator/compose/memory.rs` ä¸­çš„å¸¸é‡å®šä¹‰ï¼ˆå¦‚ `STUDIES_RESEARCH`ï¼‰å½¢æˆå¼ºä¸€è‡´æ€§ã€‚

---

### **4. æ ¸å¿ƒæ“ä½œæµç¨‹ä¸å®ç°ç»†èŠ‚**

#### **4.1 å­˜å‚¨æ•°æ®ï¼š`store(scope, key, data)`**

```mermaid
sequenceDiagram
    participant External
    participant Memory
    External->>Memory: store(scope, key, data: T)
    Memory->>Memory: full_key = format!("{}:{}", scope, key)
    Memory->>Memory: serialized = serde_json::to_value(data).unwrap()
    Memory->>Memory: size = serde_json::to_string(&serialized).unwrap().len()
    Memory->>Memory: metadata.data_sizes.insert(full_key, size)
    Memory->>Memory: metadata.total_size += size
    Memory->>Memory: data.insert(full_key, serialized)
    Memory->>Memory: metadata.last_updated = SystemTime::now()
    Memory-->>External: Ok(())
```

**å®ç°è¦ç‚¹**ï¼š
- **åºåˆ—åŒ–**ï¼šä½¿ç”¨ `serde_json::to_value()` å°†æ³›å‹ `T: Serialize` è½¬ä¸º `Value`ï¼Œæ”¯æŒåµŒå¥—ç»“æ„ã€æ•°ç»„ã€Optionç­‰ã€‚
- **å¤§å°è®¡ç®—**ï¼šå°† `Value` åºåˆ—åŒ–ä¸º JSON å­—ç¬¦ä¸²åè®¡ç®— `.len()`ï¼Œä½œä¸ºâ€œå†…å­˜å ç”¨â€ä¼°ç®—å€¼ï¼ˆéå®é™…å †å†…å­˜ï¼Œä½†å…·å¯æ¯”æ€§ï¼‰ã€‚
- **å…ƒæ•°æ®æ›´æ–°**ï¼šåŒæ­¥æ›´æ–° `data_sizes` å’Œ `total_size`ï¼Œä¸º `get_usage_stats()` æä¾›å‡†ç¡®æ•°æ®ã€‚
- **é”™è¯¯å¤„ç†**ï¼šå¤±è´¥æ—¶è¿”å› `Err`ï¼Œä¸ panicï¼Œç¡®ä¿ç³»ç»Ÿç¨³å®šæ€§ã€‚

> ğŸ’¡ **ä¸ºä»€ä¹ˆç”¨ JSON å­—ç¬¦ä¸²é•¿åº¦ï¼Ÿ**  
> éç²¾ç¡®å†…å­˜å ç”¨ï¼Œä½†å…·å¤‡**ç›¸å¯¹å¯æ¯”æ€§**å’Œ**å¯è®¡ç®—æ€§**ï¼Œé€‚åˆç”¨äºï¼š
> - èµ„æºç›‘æ§ï¼ˆå¦‚ï¼š`research` é˜¶æ®µæ¶ˆè€—äº† 2.1MBï¼‰
> - ç¼“å­˜ç­–ç•¥å‚è€ƒï¼ˆå¤§å¯¹è±¡å¯è§¦å‘é™çº§ï¼‰
> - æ€§èƒ½æŠ¥å‘Šç”Ÿæˆï¼ˆ`SummaryOutlet`ï¼‰

#### **4.2 è·å–æ•°æ®ï¼š`get<T>(scope, key)`**

```mermaid
sequenceDiagram
    participant External
    participant Memory
    External->>Memory: è·å–è¯·æ±‚
    Memory->>Memory: ç”Ÿæˆå®Œæ•´é”®å
    Memory->>Memory: å¢åŠ è®¿é—®è®¡æ•°
    Memory->>Memory: æŸ¥æ‰¾é”®å€¼
    Memory->>Memory: è§£ææŸ¥è¯¢ç»“æœ
    Memory-->>External: è¿”å›ç»“æœ
```

**å®ç°è¦ç‚¹**ï¼š
- **è®¿é—®è®¡æ•°**ï¼šæ¯æ¬¡è¯»å–è‡ªåŠ¨é€’å¢ `access_counts`ï¼Œç”¨äºè¯†åˆ«é«˜é¢‘/å†·æ•°æ®ï¼Œæ”¯æŒæœªæ¥ç¼“å­˜æ·˜æ±°ç­–ç•¥ã€‚
- **ååºåˆ—åŒ–å®‰å…¨**ï¼šä½¿ç”¨ `serde_json::from_value::<T>()`ï¼Œå¤±è´¥è¿”å› `None`ï¼Œé¿å… panicã€‚
- **ç±»å‹å®‰å…¨**ï¼šè°ƒç”¨æ–¹æŒ‡å®šæ³›å‹ `T: DeserializeOwned`ï¼Œç¼–è¯‘æœŸä¿è¯ç±»å‹æ­£ç¡®æ€§ã€‚
- **é›¶æ‹·è´è¯»å–**ï¼š`data.get()` è¿”å›å¼•ç”¨ï¼Œä¸å¤åˆ¶ `Value`ï¼Œæ€§èƒ½é«˜æ•ˆã€‚

#### **4.3 åˆ—å‡ºä½œç”¨åŸŸé”®ï¼š`list_keys(scope)`**

```mermaid
sequenceDiagram
    participant External
    participant Memory
    External->>Memory: list_keys(scope)
    Memory->>Memory: prefix = format!("{}:", scope)
    Memory->>Memory: keys = data.keys().filter(|k| k.starts_with(prefix)).map(|k| k.strip_prefix(prefix).unwrap().to_string()).collect()
    Memory-->>External: Vec<String>
```

**å®ç°è¦ç‚¹**ï¼š
- ä½¿ç”¨ `starts_with()` å‰ç¼€åŒ¹é…ï¼Œé¿å…æ­£åˆ™è¡¨è¾¾å¼å¼€é”€ã€‚
- ä½¿ç”¨ `strip_prefix()` æå–é”®ååç¼€ï¼Œè¿”å›å¹²å‡€çš„ `key` åˆ—è¡¨ï¼ˆå¦‚ `code_insights` è€Œé `preprocess:code_insights`ï¼‰ã€‚
- é€‚ç”¨äº UI å±•ç¤ºã€è°ƒè¯•å·¥å…·ã€è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆç­‰åœºæ™¯ã€‚

#### **4.4 è·å–å†…å­˜ä½¿ç”¨ç»Ÿè®¡ï¼š`get_usage_stats()`**

```mermaid
sequenceDiagram
    participant External
    participant Memory
    External->>Memory: get_usage_stats
    Memory->>Memory: åˆ›å»ºç»Ÿè®¡æ˜ å°„
    Memory->>Memory: éå†æ•°æ®å¤§å°ç»Ÿè®¡
    Memory-->>External: stats
```

**å®ç°è¦ç‚¹**ï¼š
- éå† `data_sizes`ï¼ŒæŒ‰ `scope` èšåˆæ€»å¤§å°ã€‚
- è¿”å› `HashMap<scope, usize>`ï¼Œä¾‹å¦‚ï¼š
  ```rust
  {
    "preprocess": 2145000,
    "research": 1892000,
    "compose": 456000,
  }
  ```
- ä¸º `SummaryOutlet` æä¾›æ•°æ®ï¼Œç”Ÿæˆâ€œå†…å­˜åˆ†å¸ƒæŠ¥å‘Šâ€ï¼Œé‡åŒ–å„é˜¶æ®µèµ„æºæ¶ˆè€—ã€‚

#### **4.5 è¾…åŠ©æ–¹æ³•ï¼š`has_data(scope, key)`**

```rust
pub fn has_data(&self, scope: &str, key: &str) -> bool {
    let full_key = format!("{}:{}", scope, key);
    self.data.contains_key(&full_key)
}
```

- ç”¨äºæ¡ä»¶åˆ¤æ–­ï¼Œå¦‚ï¼šâ€œæ˜¯å¦å·²ç”Ÿæˆç³»ç»Ÿä¸Šä¸‹æ–‡ï¼Ÿâ€
- é¿å… `get()` ååˆ¤æ–­ `Some(_)`, æå‡è¯­ä¹‰æ¸…æ™°åº¦ã€‚

---

### **5. å…ƒæ•°æ®ç®¡ç†æœºåˆ¶**

| å…ƒæ•°æ®é¡¹ | ç±»å‹ | ç”¨é€” | æ›´æ–°æ—¶æœº |
|----------|------|------|----------|
| `created_at` | `SystemTime` | æ ‡è¯†å­˜å‚¨åŸŸåˆå§‹åŒ–æ—¶é—´ | æ„é€ å‡½æ•°ä¸­è®¾ç½®ä¸€æ¬¡ |
| `last_updated` | `SystemTime` | æ ‡è¯†æœ€è¿‘ä¸€æ¬¡å†™å…¥æ—¶é—´ | æ¯æ¬¡ `store()` åæ›´æ–° |
| `access_counts` | `HashMap<String, u64>` | ç»Ÿè®¡æ¯ä¸ªé”®çš„è¯»å–é¢‘ç‡ | æ¯æ¬¡ `get()` åé€’å¢ |
| `data_sizes` | `HashMap<String, usize>` | æ¯ä¸ªé”®çš„åºåˆ—åŒ–åå­—èŠ‚å¤§å° | æ¯æ¬¡ `store()` æ—¶è®¡ç®—å¹¶å†™å…¥ |
| `total_size` | `usize` | æ‰€æœ‰æ•°æ®çš„æ€»å­—èŠ‚ä¼°ç®—å€¼ | æ¯æ¬¡ `store()` æ—¶ç´¯åŠ  |

> âœ… **è®¾è®¡ä»·å€¼**ï¼š  
> - ä¸º `PerformanceMonitor` æä¾›æ•°æ®æºï¼Œé‡åŒ–ç¼“å­˜èŠ‚çœçš„ Token ä¸å†…å­˜æˆæœ¬ï¼›  
> - æ”¯æŒâ€œ**å†…å­˜çƒ­åŠ›å›¾**â€åˆ†æï¼šå“ªäº›æ¨¡å—å ç”¨äº†æœ€å¤šå†…å­˜ï¼Ÿå“ªäº›é”®è¢«é¢‘ç¹è®¿é—®ï¼Ÿ  
> - ä¸ºæœªæ¥å®ç° **LRU ç¼“å­˜æ·˜æ±°**ã€**å†…å­˜é¢„è­¦**ã€**GC æœºåˆ¶** æä¾›åŸºç¡€ã€‚

---

### **6. ä¸å…¶ä»–æ¨¡å—çš„äº¤äº’æ¨¡å¼**

#### **6.1 æ•°æ®æµå…¨æ™¯ï¼ˆå…³é”®è·¯å¾„ï¼‰**

```mermaid
graph LR
    A[é¢„å¤„ç†åŸŸ] -->|store| D[å†…å­˜å­˜å‚¨åŸŸ]
    D -->|get| B[ç ”ç©¶åŸŸ]
    B -->|store| D
    D -->|get| C[æ–‡æ¡£ç¼–æ’åŸŸ]
    C -->|store| D
    D -->|get| E[è¾“å‡ºåŸŸ]
    E -->|get_usage_stats| D
    D -->|get_usage_stats| F[æ€»ç»“æŠ¥å‘Šç”Ÿæˆå™¨]
```

- **é¢„å¤„ç†åŸŸ**ï¼šå°† `ProjectStructure`ã€`CodeInsight`ã€`DependencyGraph` å­˜å…¥å†…å­˜ã€‚
- **ç ”ç©¶åŸŸ**ï¼šä»å†…å­˜è¯»å–é¢„å¤„ç†æ•°æ®ï¼Œç”Ÿæˆ `SystemContextReport`ã€`DomainModuleReport`ï¼Œå†å­˜å›ã€‚
- **æ–‡æ¡£ç¼–æ’åŸŸ**ï¼šè¯»å–ç ”ç©¶ç»“æœï¼Œç”Ÿæˆ Markdown æ–‡æ¡£ï¼Œå­˜å…¥å†…å­˜ã€‚
- **è¾“å‡ºåŸŸ**ï¼šä»å†…å­˜æå–æ–‡æ¡£ï¼Œå†™å…¥ç£ç›˜ï¼›åŒæ—¶è°ƒç”¨ `get_usage_stats()` ç”Ÿæˆæ€§èƒ½æŠ¥å‘Šã€‚

> ğŸš€ **å…³é”®åˆ›æ–°**ï¼š  
> æ‰€æœ‰æ¨¡å—**ä¸ç›´æ¥è°ƒç”¨å½¼æ­¤**ï¼Œä»…é€šè¿‡ `Memory` äº¤æ¢æ•°æ®ï¼Œå®ç°çœŸæ­£çš„**äº‹ä»¶é©±åŠ¨ã€å¼‚æ­¥åä½œ**æ¶æ„ã€‚

#### **6.2 ä¸Šä¸‹æ–‡ç®¡ç†å™¨å°è£…**

```rust
// src/generator/context.rs
pub struct GeneratorContext {
    memory: Arc<Mutex<Memory>>,
}

impl GeneratorContext {
    pub async fn store<T: Serialize>(&self, scope: &str, key: &str, data: T) -> Result<()> {
        let mut mem = self.memory.lock().await;
        mem.store(scope, key, data)
    }

    pub async fn get<T: DeserializeOwned>(&self, scope: &str, key: &str) -> Result<Option<T>> {
        let mem = self.memory.lock().await;
        mem.get(scope, key)
    }
}
```

- ä½¿ç”¨ `Arc<Mutex<Memory>>` å®ç°çº¿ç¨‹å®‰å…¨å…±äº«ï¼Œä¾›å¼‚æ­¥æ™ºèƒ½ä½“ï¼ˆ`tokio`ï¼‰å®‰å…¨è°ƒç”¨ã€‚
- å°†åŒæ­¥ `Memory` å°è£…ä¸ºå¼‚æ­¥æ¥å£ï¼Œç¬¦åˆç³»ç»Ÿæ•´ä½“å¼‚æ­¥æ¨¡å‹ã€‚
- æ‰€æœ‰æ™ºèƒ½ä½“ï¼ˆå¦‚ `code_analyze`ã€`workflow_researcher`ï¼‰å‡ä¾èµ–æ­¤ä¸Šä¸‹æ–‡ï¼Œè€Œéç›´æ¥è®¿é—® `Memory`ã€‚

---

### **7. æ€§èƒ½ä¸å¯é æ€§ä¿éšœ**

| ç»´åº¦ | ä¿éšœæªæ–½ |
|------|----------|
| **æ€§èƒ½** | - ä½¿ç”¨ `HashMap` å®ç° O(1) è¯»å†™<br>- é¿å…æ·±æ‹·è´ï¼Œ`Value` ä¸ºå¼•ç”¨è®¡æ•°ç»“æ„<br>- æ— é”è¯»å–ï¼ˆ`get`ï¼‰ï¼Œä»…å†™å…¥åŠ é” |
| **å®‰å…¨æ€§** | - æ‰€æœ‰åºåˆ—åŒ–/ååºåˆ—åŒ–ä½¿ç”¨ `unwrap()` ä¹‹å¤–çš„ `Result` è¿”å›<br>- `get()` è¿”å› `Option<T>`ï¼Œé¿å…ç©ºæŒ‡é’ˆå¼‚å¸¸<br>- é”®åæ‹¼æ¥ä½¿ç”¨ `format!`ï¼Œé¿å…æ³¨å…¥é£é™© |
| **å¯è§‚å¯Ÿæ€§** | - `access_counts` + `data_sizes` ä¸ºç›‘æ§æä¾›æ•°æ®<br>- `get_usage_stats()` æ”¯æŒå®æ—¶èµ„æºåˆ†æ |
| **å¯æµ‹è¯•æ€§** | - `Memory` æ— å¤–éƒ¨ä¾èµ–ï¼Œå¯å•å…ƒæµ‹è¯•<br>- å¯ Mock `GeneratorContext` è¿›è¡Œé›†æˆæµ‹è¯• |

---

### **8. æ‰©å±•æ€§ä¸æ¼”è¿›æ–¹å‘**

| æ–¹å‘ | è¯´æ˜ |
|------|------|
| **å†…å­˜æ·˜æ±°ç­–ç•¥** | å¼•å…¥ LRU æˆ– FIFO ç­–ç•¥ï¼Œè‡ªåŠ¨æ¸…ç†ä½é¢‘è®¿é—®æ•°æ®ï¼ˆå¦‚ `preprocess` é˜¶æ®µä¸­é—´ç»“æœï¼‰ |
| **å†…å­˜é™åˆ¶** | è®¾ç½® `max_total_size`ï¼Œè¶…é™è¿”å›é”™è¯¯æˆ–è§¦å‘ GCï¼Œé˜²æ­¢ OOM |
| **æŒä¹…åŒ–å¿«ç…§** | æ”¯æŒ `save_to_file()` / `load_from_file()`ï¼Œç”¨äºè°ƒè¯•ã€æ–­ç‚¹æ¢å¤ |
| **ç‰ˆæœ¬æ§åˆ¶** | ä¸ºæ¯ä¸ª `scope:key` æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ”¯æŒæ•°æ®å›æ»š |
| **åˆ†å¸ƒå¼æ‰©å±•** | æœªæ¥å¯æ›¿æ¢ä¸º `Redis` æˆ– `Arc<SharedMemory>`ï¼Œæ”¯æŒå¤šè¿›ç¨‹ååŒ |
| **å¯è§†åŒ–ä»ªè¡¨ç›˜** | åœ¨ CLI ä¸­è¾“å‡º `--show-memory-stats`ï¼Œå®æ—¶å±•ç¤ºå„ä½œç”¨åŸŸå†…å­˜å ç”¨ |

> ğŸ’¡ **å½“å‰çŠ¶æ€**ï¼š  
> æœ¬å®ç°å·²æ»¡è¶³å½“å‰ç³»ç»Ÿéœ€æ±‚ï¼ˆå•è¿›ç¨‹ã€é«˜é¢‘è¯»å†™ã€æ— æŒä¹…åŒ–ï¼‰ï¼Œæ˜¯**è½»é‡çº§ã€é«˜æ€§èƒ½ã€é«˜å¯é **çš„å†…å­˜æ€»çº¿å…¸èŒƒã€‚

---

### **9. å®é™…åº”ç”¨ç¤ºä¾‹**

#### **åœºæ™¯ï¼šç”Ÿæˆç³»ç»Ÿä¸Šä¸‹æ–‡æ–‡æ¡£**

1. **é¢„å¤„ç†åŸŸ**ï¼š  
   ```rust
   context.store("preprocess", "code_insights", code_insights_vec)?;
   ```

2. **ç ”ç©¶åŸŸï¼ˆ`SystemContextResearcher`ï¼‰**ï¼š  
   ```rust
   let code_insights = context.get::<Vec<CodeInsight>>("preprocess", "code_insights")?;
   let report = analyze_system_context(code_insights).await?;
   context.store("research", "system_context", report)?;
   ```

3. **æ–‡æ¡£ç¼–æ’åŸŸï¼ˆ`OverviewEditor`ï¼‰**ï¼š  
   ```rust
   let report = context.get::<SystemContextReport>("research", "system_context")?;
   let doc = render_overview_md(report)?;
   context.store("compose", "overview_doc", doc)?;
   ```

4. **è¾“å‡ºåŸŸ**ï¼š  
   ```rust
   let doc = context.get::<String>("compose", "overview_doc")?;
   disk_outlet.save("docs/system-context.md", &doc)?;
   ```

> âœ… **æ•ˆæœ**ï¼š  
> æ— éœ€æ¨¡å—é—´ç›´æ¥å¯¼å…¥ï¼Œæ•°æ®æµæ¸…æ™°ã€å¯è¿½è¸ªã€å¯è°ƒè¯•ï¼Œ**ä»»æ„é˜¶æ®µå¯ä¸­æ–­ã€é‡è·‘ã€è·³è¿‡**ã€‚

---

### **10. æ€»ç»“ï¼šå†…å­˜å­˜å‚¨åŸŸçš„æ ¸å¿ƒä»·å€¼**

| ç»´åº¦ | ä»·å€¼ä½“ç° |
|------|----------|
| **æ¶æ„å±‚é¢** | å®ç°â€œ**æ•°æ®æ€»çº¿**â€æ¨¡å¼ï¼Œæ˜¯ç³»ç»Ÿå¤šæ™ºèƒ½ä½“ååŒçš„**ç¥ç»ä¸­æ¢** |
| **å·¥ç¨‹å±‚é¢** | è§£è€¦æ¨¡å—ä¾èµ–ï¼Œæå‡å¯æµ‹è¯•æ€§ã€å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§ |
| **æ€§èƒ½å±‚é¢** | é«˜é¢‘è¯»å†™é›¶å»¶è¿Ÿï¼Œæ”¯æŒæ¯ç§’æ•°åƒæ¬¡æ“ä½œï¼Œæ»¡è¶³ AI æµæ°´çº¿éœ€æ±‚ |
| **å¯è§‚æµ‹æ€§** | å…ƒæ•°æ®é©±åŠ¨çš„ç›‘æ§èƒ½åŠ›ï¼Œä¸ºæˆæœ¬ä¼˜åŒ–ï¼ˆTokenèŠ‚çœã€å†…å­˜åˆ†æï¼‰æä¾›æ•°æ®æ”¯æ’‘ |
| **åˆ›æ–°æ€§** | åœ¨ Rust CLI å·¥å…·ä¸­ï¼Œä»¥â€œå†…å­˜ä½œä¸ºçŠ¶æ€æ€»çº¿â€å®ç°å¤æ‚ AI ååŒï¼Œå±è¡Œä¸šå‰æ²¿å®è·µ |

> ğŸ† **ç»“è®º**ï¼š  
> **å†…å­˜å­˜å‚¨åŸŸä¸æ˜¯ç®€å•çš„ç¼“å­˜ï¼Œè€Œæ˜¯ deepwiki-rs çš„â€œçŠ¶æ€ç¥ç»ç³»ç»Ÿâ€**ã€‚å®ƒä½¿ç³»ç»Ÿä»â€œç´§è€¦åˆæµæ°´çº¿â€è¿›åŒ–ä¸ºâ€œæ¾è€¦åˆæ™ºèƒ½ä½“ç½‘ç»œâ€ï¼Œæ˜¯å®ç°â€œè‡ªåŠ¨åŒ–æ¶æ„æ–‡æ¡£ç”Ÿæˆâ€è¿™ä¸€å¤æ‚ä»»åŠ¡çš„**å…³é”®æ¶æ„å†³ç­–**ã€‚

---

**é™„å½•ï¼šç›¸å…³æ–‡ä»¶æ¸…å•**

| æ–‡ä»¶è·¯å¾„ | ä½œç”¨ |
|----------|------|
| `src/memory/mod.rs` | æ ¸å¿ƒå®ç°ï¼š`Memory`ã€`MemoryMetadata`ã€æ¥å£æ–¹æ³• |
| `src/generator/context.rs` | å¼‚æ­¥å°è£…å™¨ï¼Œä¾›æ™ºèƒ½ä½“è°ƒç”¨ |
| `src/generator/research/memory.rs` | ç ”ç©¶åŸŸé”®åå¸¸é‡å®šä¹‰ |
| `src/generator/compose/memory.rs` | æ–‡æ¡£ç¼–æ’åŸŸé”®åå¸¸é‡å®šä¹‰ |
| `src/generator/outlet/summary_generator.rs` | ä½¿ç”¨ `get_usage_stats()` ç”Ÿæˆå†…å­˜æŠ¥å‘Š |

> âœ… **å»ºè®®**ï¼šå°†æœ¬æ–‡æ¡£åµŒå…¥é¡¹ç›® `docs/architecture/memory-domain.md`ï¼Œä½œä¸ºå›¢é˜ŸæŠ€æœ¯å…±è¯†æ–‡æ¡£ã€‚

---