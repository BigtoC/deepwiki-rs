# é¢„å¤„ç†åŸŸæŠ€æœ¯å®ç°æ–‡æ¡£

---

## **1. æ¦‚è¿°**

**é¢„å¤„ç†åŸŸï¼ˆPreprocessing Domainï¼‰** æ˜¯ `deepwiki-rs` ç³»ç»Ÿä¸­è´Ÿè´£å°†åŸå§‹ä»£ç åº“è½¬åŒ–ä¸º**ç»“æ„åŒ–è¯­ä¹‰æ•°æ®**çš„æ ¸å¿ƒä¸šåŠ¡æ¨¡å—ã€‚ä½œä¸ºâ€œä»£ç  â†’ æ–‡æ¡£â€è‡ªåŠ¨åŒ–æµç¨‹çš„**ç¬¬ä¸€é“å…³é”®åŠ å·¥ç¯èŠ‚**ï¼Œå®ƒæ‰¿æ‹…ç€ä»æ— åºçš„æ–‡ä»¶ç³»ç»Ÿä¸­æå–ç»“æ„ã€è¯­ä¹‰ä¸ä¸Šä¸‹æ–‡çš„é‡ä»»ï¼Œä¸ºä¸Šå±‚ç ”ç©¶åŸŸä¸æ–‡æ¡£ç¼–æ’åŸŸæä¾›é«˜è´¨é‡ã€æ ‡å‡†åŒ–çš„è¾“å…¥æ•°æ®ã€‚

æœ¬åŸŸé€šè¿‡â€œ**ç»“æ„æ‰«æ â†’ è¯­è¨€è§£æ â†’ AIå¢å¼ºåˆ†æ**â€ä¸‰é˜¶æ®µæµæ°´çº¿ï¼Œå®ç°å¯¹å¤šè¯­è¨€é¡¹ç›®ï¼ˆRustã€Pythonã€JSã€Javaã€Vueã€Reactã€Svelteã€Kotlin ç­‰ï¼‰çš„æ·±åº¦ç†è§£ï¼Œæ˜¯ç³»ç»Ÿå®ç°â€œ**æ— éœ€äººå·¥å¹²é¢„çš„æ¶æ„çŸ¥è¯†æå–**â€èƒ½åŠ›çš„åŸºçŸ³ã€‚

> âœ… **æ ¸å¿ƒä»·å€¼**ï¼šå°†æ··æ²Œçš„æºç æ–‡ä»¶è½¬åŒ–ä¸ºå¯è¢«AIæ™ºèƒ½ä½“ç†è§£çš„**ç»“æ„åŒ–ä¸Šä¸‹æ–‡æ¨¡å‹**ï¼Œæ˜¯ç³»ç»Ÿä»â€œè¯»æ–‡ä»¶â€è¿ˆå‘â€œæ‡‚ä»£ç â€çš„å…³é”®è·ƒè¿ã€‚

---

## **2. æ¶æ„å®šä½ä¸èŒè´£è¾¹ç•Œ**

### **2.1 åœ¨ç³»ç»Ÿæ¶æ„ä¸­çš„ä½ç½®**

é¢„å¤„ç†åŸŸå±äº**æ ¸å¿ƒä¸šåŠ¡åŸŸ**ï¼Œä½äºç³»ç»Ÿä¸»æµç¨‹çš„ç¬¬äºŒé˜¶æ®µï¼Œç´§éšé…ç½®åŠ è½½ä¸æ–‡ä»¶ç³»ç»Ÿè®¿é—®ï¼Œå‰ç½®ä¾èµ–**å·¥å…·æ”¯æ’‘åŸŸ**ï¼Œåç½®è¾“å‡ºè‡³**å†…å­˜å­˜å‚¨åŸŸ**ï¼Œå¹¶ä¸º**ç ”ç©¶åŸŸ**æä¾›è¾“å…¥ã€‚

```mermaid
graph LR
    A[æ–‡ä»¶ç³»ç»Ÿ] -->|è¯»å–åŸå§‹æ–‡ä»¶| B[é¢„å¤„ç†åŸŸ]
    B -->|ç»“æ„åŒ–è¯­ä¹‰æ•°æ®| C[å†…å­˜å­˜å‚¨åŸŸ]
    C -->|ä¸Šä¸‹æ–‡ä¼ é€’| D[ç ”ç©¶åŸŸ]
    E[å·¥å…·æ”¯æ’‘åŸŸ] -->|æ–‡ä»¶æ¢ç´¢/è¯»å–/æºç æå–| B
    F[LLMå®¢æˆ·ç«¯åŸŸ] -->|è¯­ä¹‰å¢å¼ºåˆ†æ| B
```

### **2.2 èŒè´£è¾¹ç•Œï¼ˆIn Scope / Out of Scopeï¼‰**

| ç±»åˆ« | å†…å®¹ |
|------|------|
| **åŒ…å«** | - é€’å½’æ‰«æé¡¹ç›®ç›®å½•ç»“æ„<br>- æ ¹æ®æ‰©å±•ååŒ¹é…è¯­è¨€å¤„ç†å™¨<br>- æå–ä»£ç ä¾èµ–ã€æ¥å£ã€ç»„ä»¶ç±»å‹<br>- è®¡ç®—æ–‡ä»¶/ç›®å½•é‡è¦æ€§è¯„åˆ†<br>- è°ƒç”¨LLMç”Ÿæˆä»£ç æ„å›¾ä¸å…³ç³»æ´å¯Ÿ<br>- å°è£…ä¸ºç»Ÿä¸€çš„ `CodeInsight` æ¨¡å‹<br>- ä¸å†…å­˜å­˜å‚¨åŸŸäº¤äº’ï¼ŒæŒä¹…åŒ–ä¸­é—´ç»“æœ |
| **ä¸åŒ…å«** | - LLMæ¨ç†é€»è¾‘çš„å®ç°ï¼ˆç”±LLMå®¢æˆ·ç«¯åŸŸè´Ÿè´£ï¼‰<br>- æ–‡æ¡£æ¨¡æ¿ç¼–æ’ï¼ˆç”±æ–‡æ¡£ç¼–æ’åŸŸè´Ÿè´£ï¼‰<br>- ç¼“å­˜ç®¡ç†ï¼ˆç”±ç¼“å­˜åŸŸè´Ÿè´£ï¼‰<br>- æ–‡ä»¶ç³»ç»Ÿåº•å±‚é©±åŠ¨æˆ–æƒé™æ§åˆ¶<br>- é…ç½®åŠ è½½æˆ–CLIå‚æ•°è§£æ |

> ğŸ“Œ **è®¾è®¡åŸåˆ™**ï¼š**å•ä¸€èŒè´£** + **æ’ä»¶åŒ–æ‰©å±•** + **æ•°æ®æŠ½è±¡**ã€‚é¢„å¤„ç†åŸŸä¸å…³å¿ƒâ€œä¸ºä»€ä¹ˆåˆ†æâ€æˆ–â€œå¦‚ä½•è¾“å‡ºâ€ï¼Œåªä¸“æ³¨â€œ**ä»æ–‡ä»¶ä¸­æå–ä»€ä¹ˆ**â€ã€‚

---

## **3. æ ¸å¿ƒå­æ¨¡å—ä¸å®ç°ç»†èŠ‚**

é¢„å¤„ç†åŸŸç”±ä¸‰ä¸ªç´§å¯†åä½œçš„å­æ¨¡å—æ„æˆï¼Œå½¢æˆâ€œ**ç»“æ„æ„ŸçŸ¥ â†’ è¯­ä¹‰è§£æ â†’ æ™ºèƒ½å¢å¼º**â€çš„ä¸‰é˜¶å¤„ç†æµæ°´çº¿ã€‚

### **3.1 å­æ¨¡å—ä¸€ï¼šç»“æ„æ‰«æå™¨ï¼ˆStructure Extractorï¼‰**

#### **èŒè´£**
é€’å½’éå†é¡¹ç›®ç›®å½•ï¼Œæ”¶é›†æ–‡ä»¶ä¸ç›®å½•çš„**å…ƒä¿¡æ¯**ï¼Œå¹¶åŸºäºè§„åˆ™è®¡ç®—å…¶**é‡è¦æ€§åˆ†æ•°**ï¼Œæ„å»º `ProjectStructure` ç»“æ„ä½“ï¼Œä½œä¸ºåç»­åˆ†æçš„â€œåœ°å›¾â€ã€‚

#### **å…³é”®æŠ€æœ¯å®ç°**

| ç»„ä»¶ | å®ç°ç»†èŠ‚ |
|------|----------|
| **é€’å½’æ‰«æç®—æ³•** | ä½¿ç”¨ `std::fs::read_dir` + `walkdir` crate å®ç°æ·±åº¦ä¼˜å…ˆéå†ï¼Œæ”¯æŒé…ç½® `max_depth` é™åˆ¶é€’å½’å±‚çº§ï¼Œé¿å…æ·±ç›®å½•çˆ†ç‚¸ã€‚ |
| **å¿½ç•¥è§„åˆ™å¼•æ“** | æ”¯æŒä»é…ç½®ä¸­åŠ è½½ `excluded_dirs`ã€`excluded_files`ï¼ˆæ”¯æŒ glob æ¨¡å¼å¦‚ `target/`, `*.log`, `node_modules/`ï¼‰ï¼Œé€šè¿‡ `glob` crate å®ç°é«˜æ•ˆåŒ¹é…ã€‚ |
| **æ–‡ä»¶å…ƒä¿¡æ¯æå–** | å¯¹æ¯ä¸ªæ–‡ä»¶æå–ï¼š<br>- `name`, `path`, `extension`, `size`, `last_modified`, `is_binary`<br>- ä½¿ç”¨ `std::fs::metadata()` è·å–ç³»ç»Ÿå±æ€§ |
| **é‡è¦æ€§è¯„åˆ†æœºåˆ¶** | åŸºäºå¤šç»´åº¦åŠ æƒè®¡ç®—ï¼ˆ0â€“1ï¼‰ï¼š<br>- **æ–‡ä»¶ç±»å‹**ï¼š`.rs`, `.py`, `.java` = 0.9ï¼›`.md`, `.toml` = 0.6ï¼›`.log`, `.tmp` = 0.1<br>- **æ–‡ä»¶å¤§å°**ï¼š>10KB = +0.2ï¼›<1KB = -0.1<br>- **è·¯å¾„æ·±åº¦**ï¼šæ ¹ç›®å½•æ–‡ä»¶ = +0.1ï¼›>5å±‚ = -0.1<br>- **æ˜¯å¦ä¸º README/CHANGELOG**ï¼šå›ºå®š +0.3<br>- **æ˜¯å¦ä¸ºå…¥å£æ–‡ä»¶**ï¼ˆå¦‚ `main.rs`, `App.js`ï¼‰ï¼š+0.4 |
| **ç›®å½•é‡è¦æ€§** | ç”±å…¶åŒ…å«æ–‡ä»¶çš„å¹³å‡é‡è¦æ€§ + æ˜¯å¦åŒ…å«æ ¸å¿ƒæ–‡ä»¶ï¼ˆå¦‚ `Cargo.toml`, `package.json`ï¼‰å†³å®šã€‚ |
| **è¾“å‡ºæ¨¡å‹** | `ProjectStructure` ç»“æ„ä½“åŒ…å«ï¼š<br>- `files: Vec<FileInfo>`<br>- `directories: Vec<DirectoryInfo>`<br>- `file_types: HashMap<String, usize>`<br>- `size_distribution: Vec<SizeBucket>` |

#### **ä»£ç å…¥å£**
```rust
// src/generator/preprocess/extractors/structure_extractor.rs
pub fn scan_project(project_path: &Path, config: &Config) -> Result<ProjectStructure> {
    let mut extractor = StructureExtractor::new(config);
    extractor.scan_directory(project_path)?;
    Ok(extractor.build_structure())
}
```

#### **äº¤äº’æ¨¡å¼**
- **è¾“å…¥**ï¼šé¡¹ç›®æ ¹è·¯å¾„ + é…ç½®ï¼ˆå¿½ç•¥è§„åˆ™ã€æœ€å¤§æ·±åº¦ï¼‰
- **è¾“å‡º**ï¼š`ProjectStructure` â†’ å­˜å…¥å†…å­˜å­˜å‚¨åŸŸï¼ˆé”®ï¼š`PROJECT_STRUCTURE`ï¼‰
- **ä¾èµ–**ï¼šå·¥å…·æ”¯æ’‘åŸŸçš„ `FileExplorer`ã€`FileReader`
- **åä½œ**ï¼šå°† `FileInfo` ä¼ é€’ç»™è¯­è¨€å¤„ç†å™¨è¿›è¡Œè¯­ä¹‰è§£æ

---

### **3.2 å­æ¨¡å—äºŒï¼šè¯­è¨€å¤„ç†å™¨ï¼ˆLanguage Processorsï¼‰**

#### **èŒè´£**
æ ¹æ®æ–‡ä»¶æ‰©å±•åï¼Œ**åŠ¨æ€é€‰æ‹©å¹¶è°ƒç”¨å¯¹åº”è¯­è¨€çš„é™æ€åˆ†æå™¨**ï¼Œæå–ä»£ç çš„**ç»“æ„åŒ–è¯­ä¹‰**ï¼ˆä¾èµ–ã€æ¥å£ã€ç»„ä»¶ç±»å‹ï¼‰ï¼Œå¹¶å°è£…ä¸ºç»Ÿä¸€çš„ `CodeInsight` æ¨¡å‹ã€‚

#### **æ¶æ„è®¾è®¡ï¼šæ’ä»¶åŒ–æ¥å£**

```rust
// src/generator/preprocess/extractors/language_processors/mod.rs
pub trait LanguageProcessor: Send + Sync {
    fn extract_dependencies(&self, content: &str, path: &Path) -> Vec<Dependency>;
    fn extract_interfaces(&self, content: &str, path: &Path) -> Vec<InterfaceInfo>;
    fn classify_component_type(&self, content: &str, path: &Path) -> ComponentType;
    fn is_important_line(&self, line: &str, line_num: usize) -> bool;
}

pub struct LanguageProcessorManager {
    processors: HashMap<String, Box<dyn LanguageProcessor>>,
}
```

#### **æ”¯æŒè¯­è¨€ä¸å®ç°ï¼ˆ10+ï¼‰**

| è¯­è¨€ | å®ç°æ–‡ä»¶ | æå–èƒ½åŠ› |
|------|----------|----------|
| Rust | `rust.rs` | `use`/`extern crate`ã€`pub fn`ã€`struct`ã€`impl`ã€`mod`ã€`#[derive]`ã€`Cargo.toml` ä¾èµ– |
| Python | `python.rs` | `import`ã€`class`ã€`def`ã€`__init__.py`ã€`requirements.txt`ã€`pyproject.toml` |
| JavaScript | `javascript.rs` | `import/export`ã€`function`ã€`class`ã€`require()`ã€`package.json` |
| TypeScript | `typescript.rs` | åŒJS + ç±»å‹æ³¨è§£ã€æ¥å£ï¼ˆ`interface`ï¼‰ã€æ³›å‹ |
| Java | `java.rs` | `import`ã€`class`ã€`interface`ã€`extends`ã€`implements`ã€`pom.xml` |
| Kotlin | `kotlin.rs` | `import`ã€`class`ã€`fun`ã€`data class`ã€`@Component`ã€`build.gradle.kts` |
| Vue | `vue.rs` | `<script>`, `<template>`, `<style>`ã€`export default`ã€`defineComponent`ã€`import` |
| React | `react.rs` | `import React`ã€`function Component`ã€`export default`ã€`useEffect`ã€`useState` |
| Svelte | `svelte.rs` | `<script>`ã€`export let`ã€`onMount`ã€`import`ã€`$$props` |
| å…¶ä»– | `mod.rs` | è‡ªåŠ¨è¯†åˆ« `.go`, `.cs`, `.swift` ç­‰ï¼Œè¿”å›åŸºç¡€å…ƒä¿¡æ¯ |

#### **å…³é”®æŠ€æœ¯å®ç°**

- **æ‰©å±•åæ˜ å°„**ï¼šä½¿ç”¨ `HashMap<String, &'static str>` æ˜ å°„ `.rs â†’ "rust"`ï¼Œé€šè¿‡ `Path::extension()` å¿«é€ŸåŒ¹é…ã€‚
- **è¯­æ³•è§£æ**ï¼šé‡‡ç”¨**è½»é‡çº§æ­£åˆ™ + å­—ç¬¦ä¸²åŒ¹é…**ï¼ˆéå®Œæ•´ASTï¼‰ï¼Œå…¼é¡¾æ€§èƒ½ä¸è¦†ç›–ç‡ã€‚ä¾‹å¦‚ï¼š
  ```rust
  // Rust: æå– pub fn
  lazy_static! {
      static ref PUB_FN_RE: Regex = Regex::new(r#"pub\s+fn\s+(\w+)"#).unwrap();
  }
  ```
- **ç»„ä»¶ç±»å‹åˆ†ç±»**ï¼šåŸºäºå‘½åæ¨¡å¼ä¸ç»“æ„ç‰¹å¾åˆ¤æ–­ï¼š
  - `*Controller*` â†’ `ComponentType::Controller`
  - `*Service*` â†’ `ComponentType::Service`
  - `*Repository*` â†’ `ComponentType::Repository`
  - `*Component.vue` â†’ `ComponentType::UIComponent`
- **é‡è¦è¡Œè¯†åˆ«**ï¼šè¯†åˆ«ä¸šåŠ¡æ ¸å¿ƒé€»è¾‘è¡Œï¼ˆå¦‚ `if err != nil`ã€`return res.json()`ï¼‰ï¼Œç”¨äºåç»­AIåˆ†æèšç„¦ã€‚

#### **è¾“å‡ºæ¨¡å‹**
```rust
// src/types/code.rs
pub struct CodeInsight {
    pub file_path: PathBuf,
    pub dependencies: Vec<Dependency>,
    pub interfaces: Vec<InterfaceInfo>,
    pub component_type: ComponentType,
    pub is_core: bool, // æ˜¯å¦ä¸ºæ ¸å¿ƒæ–‡ä»¶ï¼ˆé‡è¦æ€§ > 0.8ï¼‰
    pub important_lines: Vec<usize>, // é‡è¦ä»£ç è¡Œå·
    pub language: Language,
}
```

#### **äº¤äº’æ¨¡å¼**
- **è¾“å…¥**ï¼š`FileInfo` + æ–‡ä»¶å†…å®¹ï¼ˆç”± `FileReader` æä¾›ï¼‰
- **è¾“å‡º**ï¼š`CodeInsight` â†’ å­˜å…¥å†…å­˜å­˜å‚¨åŸŸï¼ˆé”®ï¼š`CODE_INSIGHT::<file_path>`ï¼‰
- **ä¾èµ–**ï¼š`FileReader`ï¼ˆå·¥å…·æ”¯æ’‘åŸŸï¼‰ã€`Config`ï¼ˆé…ç½®ç®¡ç†åŸŸï¼‰
- **åä½œ**ï¼šå°† `CodeInsight` ä¼ é€’ç»™ AI åˆ†æä»£ç†è¿›è¡Œè¯­ä¹‰å¢å¼º

---

### **3.3 å­æ¨¡å—ä¸‰ï¼šAIåˆ†æä»£ç†ï¼ˆAI Analysis Agentsï¼‰**

#### **èŒè´£**
è°ƒç”¨ LLM å®¢æˆ·ç«¯åŸŸï¼Œå¯¹ä»£ç ç‰‡æ®µè¿›è¡Œ**è¯­ä¹‰å¢å¼ºåˆ†æ**ï¼Œç”Ÿæˆ**äººç±»å¯ç†è§£çš„æ´å¯Ÿ**ï¼Œå¼¥è¡¥é™æ€åˆ†æçš„è¯­ä¹‰ç›²åŒºã€‚

#### **ä¸‰å¤§åˆ†æä»»åŠ¡**

| ä»£ç† | åŠŸèƒ½ | è¾“å…¥ | è¾“å‡º | ç”¨é€” |
|------|------|------|------|------|
| `code_analyze` | ä»£ç æ•´ä½“è¯­ä¹‰åˆ†æ | `CodeInsight` + æ–‡ä»¶å†…å®¹ | `CodePurpose`ï¼ˆå¦‚â€œç”¨æˆ·è®¤è¯æœåŠ¡â€ã€â€œæ”¯ä»˜ç½‘å…³â€ï¼‰ | ä¸ºæ¨¡å—å‘½åä¸åˆ†ç±»æä¾›ä¾æ® |
| `code_purpose_analyze` | æ–‡ä»¶æ„å›¾åˆ†ç±» | `CodeInsight` + æ–‡ä»¶è·¯å¾„ | `PurposeClassification`ï¼ˆå¦‚â€œæ ¸å¿ƒä¸šåŠ¡â€ã€â€œé…ç½®â€ã€â€œæµ‹è¯•â€ï¼‰ | è¾…åŠ©æ¶æ„å›¾åˆ†ç»„ |
| `relationships_analyze` | æ¨¡å—é—´ä¾èµ–å…³ç³»æ¨æ–­ | å¤šä¸ª `CodeInsight` + é¡¹ç›®ç»“æ„ | `RelationshipGraph`ï¼ˆJSONæ ¼å¼çš„ä¾èµ–è¾¹ï¼‰ | ç”Ÿæˆæ¶æ„å›¾çš„è¿æ¥çº¿ |

#### **å…³é”®æŠ€æœ¯å®ç°**

- **Prompt å·¥ç¨‹**ï¼šé‡‡ç”¨**ç»“æ„åŒ–æ¨¡æ¿**ï¼Œç¡®ä¿è¾“å‡ºå¯è§£æï¼š
  ```rust
  // code_analyze.rs
  const PROMPT_TEMPLATE: &str = r#"
  ä½ æ˜¯ä¸€ä¸ªèµ„æ·±æ¶æ„å¸ˆã€‚è¯·åˆ†æä»¥ä¸‹ä»£ç æ–‡ä»¶ï¼Œç”¨ä¸€å¥è¯æ€»ç»“å…¶æ ¸å¿ƒåŠŸèƒ½ã€‚
  æ–‡ä»¶è·¯å¾„ï¼š{path}
  è¯­è¨€ï¼š{language}
  ç»„ä»¶ç±»å‹ï¼š{component_type}
  ä¾èµ–ï¼š{dependencies}
  é‡è¦è¡Œï¼š{important_lines}

  è¯·ä»…è¿”å›ä¸€ä¸ªJSONå¯¹è±¡ï¼š{{"purpose": "å­—ç¬¦ä¸²æè¿°"}}
  "#;
  ```

- **LLM è°ƒç”¨å°è£…**ï¼šé€šè¿‡ `LLMClient::execute_extract()` è°ƒç”¨ ReAct æ‰§è¡Œå™¨ï¼Œè‡ªåŠ¨å¤„ç†ï¼š
  - Token ä¼°ç®—
  - å¤šè½®äº¤äº’ï¼ˆå¦‚é¦–æ¬¡è¿”å›æ¨¡ç³Šï¼ŒäºŒæ¬¡è¿½é—®ï¼‰
  - å¤±è´¥å›é€€ï¼ˆfallback åˆ°é»˜è®¤åˆ†ç±»ï¼‰
  - ç¼“å­˜å‘½ä¸­æ£€æŸ¥ï¼ˆç”±ç¼“å­˜åŸŸé€æ˜å¤„ç†ï¼‰

- **ç»“æœæ ‡å‡†åŒ–**ï¼šå°† LLM è¿”å›çš„ JSON è§£æä¸ºç»Ÿä¸€ç»“æ„ï¼š
  ```rust
  pub struct CodePurpose {
      pub purpose: String, // e.g., "ç”¨æˆ·ç™»å½•ä¸æƒé™æ ¡éªŒæ¨¡å—"
      pub confidence: f32, // 0.0â€“1.0ï¼Œç”±LLMç½®ä¿¡åº¦æˆ–è§„åˆ™æ¨æ–­
  }
  ```

- **å¹¶å‘æ§åˆ¶**ï¼šä½¿ç”¨å·¥å…·æ”¯æ’‘åŸŸçš„ `do_parallel_with_limit()` é™åˆ¶å¹¶å‘åˆ†æä»»åŠ¡æ•°ï¼ˆé»˜è®¤ 5ï¼‰ï¼Œé¿å… LLM æœåŠ¡è¿‡è½½ã€‚

#### **äº¤äº’æ¨¡å¼**
- **è¾“å…¥**ï¼š`CodeInsight` é›†åˆï¼ˆæ¥è‡ªè¯­è¨€å¤„ç†å™¨ï¼‰
- **è¾“å‡º**ï¼š`CodePurpose`ã€`RelationshipGraph` â†’ å­˜å…¥å†…å­˜å­˜å‚¨åŸŸï¼ˆé”®ï¼š`CODE_PURPOSE::<file_path>`ã€`RELATIONSHIP_GRAPH`ï¼‰
- **ä¾èµ–**ï¼š`LLMClient`ï¼ˆLLMå®¢æˆ·ç«¯åŸŸï¼‰ã€`MemoryContext`ï¼ˆå†…å­˜å­˜å‚¨åŸŸï¼‰
- **åä½œ**ï¼šä¸ºç ”ç©¶åŸŸæä¾›â€œ**è¯­ä¹‰æ ‡ç­¾**â€ä¸â€œ**ä¾èµ–å›¾è°±**â€ï¼Œä½¿æ™ºèƒ½ä½“èƒ½ç†è§£â€œ**è¿™ä¸ªæ¨¡å—æ˜¯åšä»€ä¹ˆçš„**â€

---

## **4. æ•°æ®æµä¸ä¸Šä¸‹æ–‡ä¼ é€’**

### **4.1 ä¸»æ•°æ®æµï¼ˆé¢„å¤„ç†åŸŸå†…éƒ¨ï¼‰**

```mermaid
graph LR
    A[æ–‡ä»¶ç³»ç»Ÿ] --> B[ç»“æ„æ‰«æå™¨]
    B --> C[è¯­è¨€å¤„ç†å™¨ç®¡ç†å™¨]
    C --> D[è¯­è¨€å¤„ç†å™¨]
    D --> E[CodeInsight]
    E --> F[AIåˆ†æä»£ç†]
    F --> G[CodePurpose / RelationshipGraph]
    G --> H[å†…å­˜å­˜å‚¨åŸŸ]
```

### **4.2 ä¸Šä¸‹æ–‡ä¼ é€’æœºåˆ¶**

æ‰€æœ‰ä¸­é—´ç»“æœé€šè¿‡**å†…å­˜å­˜å‚¨åŸŸ**ï¼ˆ`GeneratorContext`ï¼‰è¿›è¡Œå¼‚æ­¥ä¼ é€’ï¼Œå®ç°**æ— çŠ¶æ€ã€é«˜å†…èš**çš„æ¨¡å—åä½œï¼š

| æ•°æ® | å†…å­˜é”®å | ç”Ÿäº§è€… | æ¶ˆè´¹è€… |
|------|----------|--------|--------|
| `ProjectStructure` | `PROJECT_STRUCTURE` | ç»“æ„æ‰«æå™¨ | ç ”ç©¶åŸŸï¼ˆé¢†åŸŸæ¨¡å—æ¢æµ‹å™¨ï¼‰ |
| `CodeInsight` | `CODE_INSIGHT::<file_path>` | è¯­è¨€å¤„ç†å™¨ | AIåˆ†æä»£ç†ã€ç ”ç©¶åŸŸ |
| `CodePurpose` | `CODE_PURPOSE::<file_path>` | AIåˆ†æä»£ç† | æ–‡æ¡£ç¼–æ’åŸŸï¼ˆæ¨¡å—æ´å¯Ÿç¼–è¾‘å™¨ï¼‰ |
| `RelationshipGraph` | `RELATIONSHIP_GRAPH` | AIåˆ†æä»£ç† | ç ”ç©¶åŸŸï¼ˆæ¶æ„å›¾ç”Ÿæˆå™¨ï¼‰ |

> âœ… **ä¼˜åŠ¿**ï¼š  
> - æ¨¡å—é—´**æ— ç›´æ¥ä¾èµ–**ï¼Œä»…é€šè¿‡é”®åé€šä¿¡  
> - æ”¯æŒ**å¹¶è¡Œå¤„ç†**ï¼ˆè¯­è¨€å¤„ç†å™¨å¯å¹¶å‘æ‰§è¡Œï¼‰  
> - æ”¯æŒ**æ–­ç‚¹æ¢å¤**ï¼ˆç¼“å­˜å¯è·³è¿‡å·²åˆ†ææ–‡ä»¶ï¼‰  
> - æ”¯æŒ**è°ƒè¯•ä¸å›æº¯**ï¼ˆå¯é€šè¿‡ `get_keys_by_scope("preprocess")` æŸ¥çœ‹æ‰€æœ‰ä¸­é—´æ•°æ®ï¼‰

---

## **5. æ€§èƒ½ä¸ä¼˜åŒ–ç­–ç•¥**

### **5.1 ç¼“å­˜å¤ç”¨ï¼ˆå…³é”®ä¼˜åŒ–ï¼‰**

- **ç¼“å­˜é”®**ï¼š`MD5(PROMPT + file_content + config_hash)`
- **ç¼“å­˜ç²’åº¦**ï¼šæŒ‰æ–‡ä»¶ç²’åº¦ç¼“å­˜ `CodePurpose` ä¸ `RelationshipGraph`
- **æ•ˆæœ**ï¼š  
  - é‡å¤åˆ†æåŒä¸€é¡¹ç›®æ—¶ï¼Œ**90%+ çš„ LLM è°ƒç”¨è¢«è·³è¿‡**  
  - ç¬¬äºŒæ¬¡è¿è¡Œè€—æ—¶ä» 30s â†’ 2sï¼ˆå®æµ‹æ•°æ®ï¼‰

### **5.2 å¹¶å‘æ§åˆ¶**

| æ¨¡å— | å¹¶å‘ç­–ç•¥ |
|------|----------|
| æ–‡ä»¶æ‰«æ | å•çº¿ç¨‹ï¼ˆæ–‡ä»¶ç³»ç»ŸIOç“¶é¢ˆï¼‰ |
| è¯­è¨€å¤„ç†å™¨ | å¹¶å‘ï¼ˆ`rayon` æˆ– `tokio::task::spawn`ï¼‰ï¼Œæ¯ä¸ªæ–‡ä»¶ç‹¬ç«‹ä»»åŠ¡ |
| AIåˆ†æä»£ç† | é™åˆ¶å¹¶å‘æ•°ï¼ˆé»˜è®¤ 5ï¼‰ï¼Œé¿å… LLM é™æµ |

```rust
// src/utils/threads.rs
pub fn do_parallel_with_limit<T, F>(items: Vec<T>, limit: usize, f: F) -> Vec<Result<T>>
where
    F: Fn(T) -> Result<T> + Send + 'static,
    T: Send,
{
    let semaphore = Arc::new(Semaphore::new(limit));
    let handles: Vec<_> = items
        .into_iter()
        .map(|item| {
            let sem = semaphore.clone();
            tokio::spawn(async move {
                let _permit = sem.acquire().await.unwrap();
                f(item)
            })
        })
        .collect();
    // ç­‰å¾…å…¨éƒ¨å®Œæˆ
}
```

### **5.3 å†…å­˜æ•ˆç‡ä¼˜åŒ–**

- `CodeInsight` ä½¿ç”¨ `Arc<String>` å…±äº«æ–‡ä»¶å†…å®¹ï¼Œé¿å…å¤šæ¬¡æ‹·è´
- `ProjectStructure` ä»…å­˜å‚¨è·¯å¾„ä¸å…ƒä¿¡æ¯ï¼Œä¸ç¼“å­˜å®Œæ•´æ–‡ä»¶å†…å®¹
- ä½¿ç”¨ `DashMap` å®ç°çº¿ç¨‹å®‰å…¨ã€é«˜æ€§èƒ½çš„å†…å­˜å­˜å‚¨ï¼ˆ`HashMap` + é”ï¼‰

---

## **6. æ‰©å±•æ€§ä¸æ’ä»¶åŒ–è®¾è®¡**

### **6.1 æ–°è¯­è¨€æ”¯æŒæµç¨‹**

1. **å®ç°æ¥å£**ï¼šåœ¨ `language_processors/` ä¸‹æ–°å»º `newlang.rs`
2. **æ³¨å†Œæ˜ å°„**ï¼šåœ¨ `mod.rs` ä¸­æ·»åŠ ï¼š
   ```rust
   processors.insert("newlang".to_string(), Box::new(NewLangProcessor {}));
   ```
3. **æµ‹è¯•ç”¨ä¾‹**ï¼šç¼–å†™ `tests/test_newlang.rs`ï¼ŒéªŒè¯ä¾èµ–/æ¥å£æå–
4. **æ–‡æ¡£æ›´æ–°**ï¼šæ›´æ–° README æ”¯æŒè¯­è¨€åˆ—è¡¨

> âœ… **ç¤ºä¾‹**ï¼šæ–°å¢ `Go` æ”¯æŒä»…éœ€ 80 è¡Œä»£ç ï¼Œå³å¯è¯†åˆ« `import`ã€`func`ã€`type`ã€‚

### **6.2 æ–°åˆ†æä»»åŠ¡æ‰©å±•**

- æ–°å¢ AI ä»£ç†ï¼šå¦‚ `security_vulnerability_analyze`
- æ³¨å†Œåˆ° `AgentManager`ï¼Œåœ¨ `preprocess.rs` ä¸­è°ƒç”¨
- æ— éœ€ä¿®æ”¹å…¶ä»–æ¨¡å—ï¼Œç¬¦åˆ**å¼€é—­åŸåˆ™**

---

## **7. å…¸å‹ä½¿ç”¨åœºæ™¯ä¸ä»·å€¼ä½“ç°**

| åœºæ™¯ | é¢„å¤„ç†åŸŸä½œç”¨ | ä»·å€¼ |
|------|--------------|------|
| **æ–°æˆå‘˜å…¥èŒ** | è‡ªåŠ¨è¯†åˆ«æ ¸å¿ƒæ¨¡å—ï¼ˆå¦‚ `auth/`, `payment/`ï¼‰å¹¶æ ‡æ³¨â€œç”¨æˆ·è®¤è¯æœåŠ¡â€ | é™ä½ç†è§£æˆæœ¬ 70% |
| **æ¶æ„è¯„å®¡** | ç”Ÿæˆä¾èµ–å›¾è°±ï¼Œè‡ªåŠ¨å‘ç°å¾ªç¯ä¾èµ–ï¼ˆå¦‚ `A â†’ B â†’ C â†’ A`ï¼‰ | æå‰æš´éœ²æŠ€æœ¯å€º |
| **ä»£ç é‡æ„** | æ ‡è¯†â€œä½é‡è¦æ€§æ–‡ä»¶â€ï¼ˆå¦‚ `.log`, `test/`ï¼‰ï¼ŒæŒ‡å¯¼æ¸…ç† | å‡å°‘ç»´æŠ¤è´Ÿæ‹… |
| **LLMæˆæœ¬æ§åˆ¶** | ç¼“å­˜å·²åˆ†ææ–‡ä»¶ï¼Œé¿å…é‡å¤è°ƒç”¨ | å•æ¬¡è¿è¡ŒèŠ‚çœ 80% Token æˆæœ¬ |
| **è·¨è¯­è¨€é¡¹ç›®** | ç»Ÿä¸€å¤„ç† Rust + Python + Vueï¼Œè¾“å‡ºä¸€è‡´æ¨¡å‹ | å®ç°â€œä¸€å·¥å…·é€šåƒâ€ |

---

## **8. æ€»ç»“ï¼šé¢„å¤„ç†åŸŸçš„è®¾è®¡å“²å­¦**

| åŸåˆ™ | å®ç°æ–¹å¼ |
|------|----------|
| **åˆ†å±‚è§£è€¦** | ç»“æ„ â†’ è¯­ä¹‰ â†’ æ™ºèƒ½ï¼Œä¸‰é˜¶æ®µæ¸…æ™°åˆ†ç¦» |
| **æ’ä»¶åŒ–æ‰©å±•** | è¯­è¨€å¤„ç†å™¨ã€AIä»£ç†å‡å¯çƒ­æ’æ‹” |
| **æ•°æ®é©±åŠ¨** | æ‰€æœ‰è¾“å‡ºä¸ºç»“æ„åŒ–æ¨¡å‹ï¼Œéæ–‡æœ¬ |
| **ç¼“å­˜ä¼˜å…ˆ** | ä¸€åˆ‡å¯ç¼“å­˜çš„ï¼Œç»ä¸é‡å¤è°ƒç”¨ LLM |
| **æ— çŠ¶æ€åä½œ** | é€šè¿‡å†…å­˜åŸŸä¼ é€’ä¸Šä¸‹æ–‡ï¼Œæ¨¡å—æ— ä¾èµ– |
| **æˆæœ¬å¯æ§** | å¹¶å‘é™åˆ¶ + ç¼“å­˜ + Token ä¼°ç®—ï¼Œä¿éšœç”Ÿäº§å¯ç”¨ |

> ğŸ’¡ **ä¸€å¥è¯æ€»ç»“**ï¼š  
> **é¢„å¤„ç†åŸŸæ˜¯ deepwiki-rs çš„â€œçœ¼ç›â€ä¸â€œå¤§è„‘åˆç­›å™¨â€â€”â€”å®ƒä¸å†³å®šâ€œå†™ä»€ä¹ˆæ–‡æ¡£â€ï¼Œä½†å®ƒå†³å®šäº†â€œç³»ç»Ÿé‡Œæœ‰ä»€ä¹ˆå€¼å¾—è¢«å†™â€ã€‚**

---

## **é™„å½•ï¼šå…³é”®æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆç®€åŒ–ç‰ˆï¼‰**

```rust
// src/types/code.rs
pub struct ProjectStructure {
    pub files: Vec<FileInfo>,
    pub directories: Vec<DirectoryInfo>,
    pub file_types: HashMap<String, usize>,
    pub size_distribution: Vec<SizeBucket>,
}

pub struct FileInfo {
    pub path: PathBuf,
    pub name: String,
    pub extension: String,
    pub size: u64,
    pub last_modified: SystemTime,
    pub is_binary: bool,
    pub importance_score: f32,
    pub is_core: bool,
}

pub struct CodeInsight {
    pub file_path: PathBuf,
    pub dependencies: Vec<Dependency>,
    pub interfaces: Vec<InterfaceInfo>,
    pub component_type: ComponentType,
    pub is_core: bool,
    pub important_lines: Vec<usize>,
    pub language: Language,
}

pub struct CodePurpose {
    pub purpose: String,
    pub confidence: f32,
}

pub struct RelationshipGraph {
    pub edges: Vec<Edge>,
    pub nodes: Vec<Node>,
}

pub struct Edge {
    pub from: String, // file_path
    pub to: String,
    pub type_: String, // "import", "call", "depends_on"
}
```

---

> âœ… **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.2  
> âœ… **æœ€åæ›´æ–°**ï¼š2025-04-05  
> âœ… **é€‚ç”¨ç‰ˆæœ¬**ï¼šdeepwiki-rs â‰¥ 0.8.0  
> âœ… **ä½œè€…**ï¼šç³»ç»Ÿæ¶æ„ç»„  
> âœ… **å…³è”æ¨¡å—**ï¼šå†…å­˜å­˜å‚¨åŸŸã€LLMå®¢æˆ·ç«¯åŸŸã€å·¥å…·æ”¯æ’‘åŸŸã€ç ”ç©¶åŸŸ

--- 

æœ¬æŠ€æœ¯æ–‡æ¡£å¯ä½œä¸ºå›¢é˜Ÿå¼€å‘ã€æ–°äººåŸ¹è®­ã€æ¶æ„è¯„å®¡çš„æ ¸å¿ƒå‚è€ƒï¼Œå»ºè®®åµŒå…¥é¡¹ç›® `docs/` ç›®å½•å¹¶åŒæ­¥è‡³ Confluenceã€‚