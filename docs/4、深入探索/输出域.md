# è¾“å‡ºåŸŸæŠ€æœ¯å®ç°æ–‡æ¡£

## 1. æ¦‚è¿°

**è¾“å‡ºåŸŸï¼ˆOutput Domainï¼‰** æ˜¯ `deepwiki-rs` ç³»ç»Ÿä¸­è´Ÿè´£å°†å†…å­˜ä¸­ç”Ÿæˆçš„ç»“æ„åŒ–æ–‡æ¡£å†…å®¹æŒä¹…åŒ–è‡³æ–‡ä»¶ç³»ç»Ÿçš„æœ€ç»ˆç¯èŠ‚ï¼Œæ˜¯â€œä»£ç  â†’ çŸ¥è¯† â†’ å¯äº¤ä»˜æ–‡æ¡£â€è‡ªåŠ¨åŒ–æµæ°´çº¿çš„ç»ˆç‚¹ã€‚è¯¥æ¨¡å—é‡‡ç”¨**é€‚é…å™¨æ¨¡å¼**ä¸**å®¹é”™é©±åŠ¨è®¾è®¡**ï¼Œé€šè¿‡ `Outlet` trait æŠ½è±¡è¾“å‡ºè¡Œä¸ºï¼Œç”± `DiskOutlet` å®ç°å…·ä½“ç£ç›˜å†™å…¥é€»è¾‘ï¼Œä¸ `DocTree` ç»“æ„ååŒå®Œæˆæ–‡æ¡£è·¯å¾„æ˜ å°„ï¼Œå¹¶é€šè¿‡ `SummaryOutlet` ç”Ÿæˆé¡¹ç›®çº§æ€»ç»“æŠ¥å‘Šï¼Œå®ç°**é«˜å†…èšã€ä½è€¦åˆã€å¼ºæ‰©å±•æ€§**çš„è¾“å‡ºèƒ½åŠ›ã€‚

è¾“å‡ºåŸŸä¸å‚ä¸æ–‡æ¡£å†…å®¹çš„ç”Ÿæˆæˆ–è¯­ä¹‰åˆ†æï¼Œå…¶æ ¸å¿ƒä»·å€¼åœ¨äºï¼š  
- **ç¡®ä¿çŸ¥è¯†äº¤ä»˜**ï¼šå°†æ™ºèƒ½ä½“ç”Ÿæˆçš„é«˜è´¨é‡æ–‡æ¡£å‡†ç¡®ã€å®Œæ•´ã€å¯é åœ°å†™å…¥ç£ç›˜ï¼›  
- **ä¿éšœæµç¨‹é²æ£’æ€§**ï¼šå³ä½¿éƒ¨åˆ†æ–‡æ¡£ç”Ÿæˆå¤±è´¥ï¼Œä¹Ÿä¸ä¸­æ–­æ•´ä½“æµç¨‹ï¼›  
- **æ”¯æŒå¤šè¾“å‡ºå½¢æ€**ï¼šä¸ºæœªæ¥æ‰©å±• PDFã€HTMLã€JSON ç­‰æ ¼å¼é¢„ç•™æ¥å£ï¼›  
- **é›†æˆæ€§èƒ½ç›‘æ§**ï¼šä¸ç¼“å­˜åŸŸè”åŠ¨ï¼Œè¾“å‡ºé¡¹ç›®çº§åˆ†ææŠ¥å‘Šï¼Œé‡åŒ–ç³»ç»Ÿæ•ˆèƒ½ã€‚

è¯¥æ¨¡å—ä½äºç³»ç»Ÿæ¶æ„çš„**å·¥å…·æ”¯æ’‘åŸŸ**ï¼Œä¾èµ–**å†…å­˜å­˜å‚¨åŸŸ**è·å–æ–‡æ¡£å†…å®¹ï¼Œä¾èµ–**æ–‡ä»¶ç³»ç»Ÿ**å®ŒæˆæŒä¹…åŒ–ï¼Œæ˜¯è¿æ¥â€œæ™ºèƒ½åˆ†æâ€ä¸â€œäººå·¥å¯è¯»äº¤ä»˜ç‰©â€çš„å…³é”®æ¡¥æ¢ã€‚

---

## 2. æ ¸å¿ƒèŒè´£ä¸è®¾è®¡åŸåˆ™

### 2.1 æ ¸å¿ƒèŒè´£

| èŒè´£ | è¯´æ˜ |
|------|------|
| **æ–‡æ¡£æŒä¹…åŒ–** | å°† `DocTree` ä¸­å®šä¹‰çš„æ¯ä¸ªæ–‡æ¡£ï¼ˆå¦‚ `AgentType::Overview` â†’ `1ã€é¡¹ç›®æ¦‚è¿°.md`ï¼‰ä»å†…å­˜ä¸­æå–å†…å®¹ï¼Œå†™å…¥æŒ‡å®šè·¯å¾„çš„æ–‡ä»¶ |
| **è·¯å¾„æ˜ å°„æ‰§è¡Œ** | æ ¹æ® `DocTree` é¢„å®šä¹‰çš„é”®å€¼æ˜ å°„å…³ç³»ï¼Œå°†å†…å­˜ä¸­çš„æ–‡æ¡£é”®ï¼ˆå¦‚ `"overview"`ï¼‰è½¬æ¢ä¸ºæ–‡ä»¶ç³»ç»Ÿè·¯å¾„ï¼ˆå¦‚ `docs/1ã€é¡¹ç›®æ¦‚è¿°.md`ï¼‰ |
| **ç›®å½•ç»“æ„æ„å»º** | è‡ªåŠ¨é€’å½’åˆ›å»ºæ–‡æ¡£è·¯å¾„ä¸­çš„æ‰€æœ‰çˆ¶ç›®å½•ï¼Œç¡®ä¿å†™å…¥è·¯å¾„åˆæ³• |
| **å¹¶å‘å†™å…¥æ”¯æŒ** | æ”¯æŒå¤šä¸ªæ–‡æ¡£å¹¶è¡Œå†™å…¥ï¼Œæå‡è¾“å‡ºæ•ˆç‡ï¼Œé¿å…ä¸²è¡Œé˜»å¡ |
| **å®¹é”™ä¸é™çº§** | å•ä¸ªæ–‡æ¡£å†™å…¥å¤±è´¥ä»…è®°å½•è­¦å‘Šæ—¥å¿—ï¼Œä¸å½±å“å…¶ä»–æ–‡æ¡£çš„è¾“å‡ºï¼Œç¡®ä¿æ•´ä½“æµç¨‹å®Œæˆ |
| **æ€»ç»“æŠ¥å‘Šç”Ÿæˆ** | èšåˆç¼“å­˜å‘½ä¸­ç‡ã€æ‰§è¡Œè€—æ—¶ã€å†…å­˜ä½¿ç”¨ç­‰æŒ‡æ ‡ï¼Œç”Ÿæˆ `SUMMARY.md` æ€»ç»“æŠ¥å‘Šï¼Œè¾…åŠ©ç”¨æˆ·è¯„ä¼°ç³»ç»Ÿæ•ˆèƒ½ |
| **æ¥å£æŠ½è±¡** | é€šè¿‡ `Outlet` trait å®šä¹‰ç»Ÿä¸€è¾“å‡ºæ¥å£ï¼Œè§£è€¦å†…å®¹ç”Ÿæˆä¸è¾“å‡ºå®ç°ï¼Œæ”¯æŒæœªæ¥æ‰©å±•å¤šç§è¾“å‡ºç›®æ ‡ï¼ˆå¦‚ç½‘ç»œã€æ•°æ®åº“ã€å‹ç¼©åŒ…ï¼‰ |

### 2.2 è®¾è®¡åŸåˆ™

| åŸåˆ™ | å®ç°æ–¹å¼ |
|------|----------|
| **å•ä¸€èŒè´£** | è¾“å‡ºåŸŸä»…è´Ÿè´£â€œå†™æ–‡ä»¶â€ï¼Œä¸å‚ä¸æ–‡æ¡£ç”Ÿæˆã€è·¯å¾„è§£æã€å†…å®¹æ ¼å¼åŒ–ç­‰é€»è¾‘ |
| **ä¾èµ–å€’ç½®** | ä¾èµ– `Outlet` æ¥å£è€Œéå…·ä½“å®ç°ï¼Œ`DiskOutlet` å’Œ `SummaryOutlet` å‡å®ç°è¯¥æ¥å£ |
| **å¼‚æ­¥éé˜»å¡** | æ‰€æœ‰ I/O æ“ä½œå‡ä¸ºå¼‚æ­¥ï¼ˆ`async fn`ï¼‰ï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œæå‡å¹¶å‘åå |
| **æ— çŠ¶æ€è®¾è®¡** | `DiskOutlet` ä¸ä¿å­˜çŠ¶æ€ï¼Œæ¯æ¬¡ `save()` è°ƒç”¨å‡ä¸ºç‹¬ç«‹æ“ä½œï¼Œæ”¯æŒé‡å…¥ä¸å¹¶è¡Œ |
| **å¤±è´¥ä¸ä¸­æ–­** | ä½¿ç”¨ `warn!` è€Œé `Err()` æŠ¥å‘Šå†™å…¥å¤±è´¥ï¼Œç¡®ä¿â€œéƒ¨åˆ†å¤±è´¥ â‰  å…¨å±€å¤±è´¥â€ |
| **é…ç½®é©±åŠ¨** | è¾“å‡ºè·¯å¾„ã€æ˜¯å¦ç”Ÿæˆæ€»ç»“æŠ¥å‘Šç­‰è¡Œä¸ºç”± `GeneratorContext.config` é©±åŠ¨ï¼Œå®ç°è¿è¡Œæ—¶å¯é…ç½® |

---

## 3. æ ¸å¿ƒç»„ä»¶ä¸ç»“æ„

### 3.1 `Outlet` Trait â€”â€” è¾“å‡ºè¡Œä¸ºæŠ½è±¡

```rust
// src/generator/outlet/mod.rs
pub trait Outlet {
    async fn save(&self, context: &GeneratorContext) -> Result<(), Box<dyn std::error::Error>>;
}
```

- **ä½œç”¨**ï¼šå®šä¹‰è¾“å‡ºåŸŸå¯¹å¤–ç»Ÿä¸€æ¥å£ï¼Œå±è”½å…·ä½“å®ç°å·®å¼‚ã€‚
- **è¾“å…¥**ï¼š`GeneratorContext` â€”â€” åŒ…å«é…ç½®ã€å†…å­˜å­˜å‚¨ã€æ–‡æ¡£æ ‘ç­‰æ‰€æœ‰å¿…è¦ä¸Šä¸‹æ–‡ã€‚
- **è¾“å‡º**ï¼š`Result<(), Error>` â€”â€” æˆåŠŸè¿”å› `Ok(())`ï¼Œå¤±è´¥è¿”å›å¸¦æè¿°çš„é”™è¯¯ï¼ˆä»…ç”¨äºä¸¥é‡å¼‚å¸¸ï¼Œéä¸šåŠ¡å¤±è´¥ï¼‰ã€‚
- **è®¾è®¡æ„ä¹‰**ï¼šå…è®¸æœªæ¥è½»æ¾æ‰©å±• `WebOutlet`ï¼ˆä¸Šä¼ è‡³ Wikiï¼‰ã€`ZipOutlet`ï¼ˆæ‰“åŒ…è¾“å‡ºï¼‰ã€`DBOutlet`ï¼ˆå­˜å…¥æ•°æ®åº“ï¼‰ç­‰å®ç°ï¼Œå®ç°â€œä¸€æ¬¡ç¼–æ’ï¼Œå¤šç«¯è¾“å‡ºâ€ã€‚

### 3.2 `DiskOutlet` â€”â€” ç£ç›˜å†™å…¥å®ç°

**æ ¸å¿ƒå®ç°æ–‡ä»¶**ï¼š`src/generator/outlet/mod.rs`

#### 3.2.1 ç»“æ„å®šä¹‰

```rust
pub struct DiskOutlet;
```

- æ— çŠ¶æ€ç»“æ„ä½“ï¼Œä»…ä½œä¸º `Outlet` trait çš„å®ç°è½½ä½“ã€‚
- æ— å­—æ®µï¼Œä¸æŒæœ‰ä»»ä½•é…ç½®æˆ–ç¼“å­˜ï¼Œå®Œå…¨ä¾èµ–ä¼ å…¥çš„ `context`ã€‚

#### 3.2.2 æ ¸å¿ƒæ–¹æ³•ï¼š`save`

```rust
impl Outlet for DiskOutlet {
    async fn save(&self, context: &GeneratorContext) -> Result<(), Box<dyn std::error::Error>> {
        // 1. æ¸…ç†å¹¶é‡å»ºè¾“å‡ºç›®å½•
        let output_path = &context.config.output_path;
        if output_path.exists() {
            fs::remove_dir_all(output_path).await?;
        }
        fs::create_dir_all(output_path).await?;

        // 2. éå† DocTree æ˜ å°„å…³ç³»
        for (scoped_key, filename) in &context.doc_tree {
            // 3. ä»å†…å­˜ä¸­å¼‚æ­¥è·å–æ–‡æ¡£å†…å®¹
            let doc_content = match context.get_from_memory::<String>(scoped_key).await {
                Ok(content) => content,
                Err(e) => {
                    warn!("æ— æ³•è·å–æ–‡æ¡£å†…å®¹ [{}]: {}", scoped_key, e);
                    continue; // å®¹é”™ï¼šè·³è¿‡ï¼Œç»§ç»­ä¸‹ä¸€ä¸ª
                }
            };

            // 4. æ„å»ºå®Œæ•´æ–‡ä»¶è·¯å¾„
            let full_path = output_path.join(filename);

            // 5. é€’å½’åˆ›å»ºçˆ¶ç›®å½•
            if let Some(parent) = full_path.parent() {
                fs::create_dir_all(parent).await?;
            }

            // 6. å†™å…¥æ–‡ä»¶ï¼ˆå¼‚æ­¥ï¼‰
            match fs::write(&full_path, doc_content).await {
                Ok(_) => {
                    info!("âœ… å·²ä¿å­˜æ–‡æ¡£: {}", full_path.display());
                }
                Err(e) => {
                    warn!("âŒ å†™å…¥å¤±è´¥ [{}]: {}", full_path.display(), e);
                    // ä¸ä¸­æ–­æµç¨‹ï¼Œä»…è®°å½•è­¦å‘Š
                }
            }
        }

        // 7. æ‰“å°å®Œæˆæ—¥å¿—
        info!("ğŸ‰ è¾“å‡ºåŸŸå®Œæˆï¼šæ‰€æœ‰æ–‡æ¡£å·²å†™å…¥ {}", output_path.display());
        Ok(())
    }
}
```

#### 3.2.3 å…³é”®æŠ€æœ¯ç»†èŠ‚

| æŠ€æœ¯ç‚¹ | è¯´æ˜ |
|-------|------|
| **å¼‚æ­¥æ–‡ä»¶æ“ä½œ** | ä½¿ç”¨ `tokio::fs::remove_dir_all`, `create_dir_all`, `write` å®ç°éé˜»å¡ I/Oï¼Œé¿å…çº¿ç¨‹é˜»å¡ |
| **è·¯å¾„å®‰å…¨æ„å»º** | ä½¿ç”¨ `PathBuf::join()` è€Œéå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œç¡®ä¿è·¨å¹³å°è·¯å¾„å…¼å®¹æ€§ï¼ˆWindows/Linux/macOSï¼‰ |
| **çˆ¶ç›®å½•é€’å½’åˆ›å»º** | `create_dir_all()` è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰ç¼ºå¤±çš„ä¸­é—´ç›®å½•ï¼Œæ— éœ€æ‰‹åŠ¨éå† |
| **å†…å­˜å†…å®¹è·å–** | é€šè¿‡ `context.get_from_memory::<String>(scoped_key)` ä» `MemoryStore` å¼‚æ­¥è·å–æ–‡æ¡£å†…å®¹ï¼Œä¾èµ–å†…å­˜åŸŸä½œä¸ºå”¯ä¸€æ•°æ®æº |
| **æ˜ å°„å…³ç³»æ¥æº** | `context.doc_tree` ç”± `DocumentComposer` åœ¨ç¼–æ’é˜¶æ®µå¡«å……ï¼Œé”®ä¸º `AgentType` æšä¸¾ï¼ˆå¦‚ `AgentType::Overview`ï¼‰ï¼Œå€¼ä¸ºæ ‡å‡†åŒ–æ–‡ä»¶åï¼ˆå¦‚ `"1ã€é¡¹ç›®æ¦‚è¿°.md"`ï¼‰ |
| **å¹¶å‘å†™å…¥æ”¯æŒ** | `for` å¾ªç¯ä¸­æ¯ä¸ª `write` æ“ä½œç‹¬ç«‹å¼‚æ­¥ï¼Œç”± Tokio è°ƒåº¦å™¨å¹¶å‘æ‰§è¡Œï¼Œæ— éœ€æ˜¾å¼ `join_all`ï¼Œå®ç°è‡ªç„¶å¹¶å‘ |
| **é”™è¯¯å¤„ç†ç­–ç•¥** | **ä¸æŠ›å‡ºå¼‚å¸¸ï¼Œä¸è¿”å› `Err`**ï¼Œä»…ä½¿ç”¨ `warn!` è®°å½•å¤±è´¥ï¼Œç¡®ä¿â€œéƒ¨åˆ†å¤±è´¥ä¸å½±å“æ•´ä½“å®Œæˆâ€ |
| **æ—¥å¿—åˆ†çº§** | æˆåŠŸå†™å…¥ä½¿ç”¨ `info!`ï¼Œå¤±è´¥ä½¿ç”¨ `warn!`ï¼Œç›®å½•æ¸…ç†/åˆ›å»ºä½¿ç”¨ `debug!`ï¼Œç¬¦åˆæ—¥å¿—è§„èŒƒ |

#### 3.2.4 ä¾èµ–å…³ç³»å›¾

```mermaid
graph LR
    DiskOutlet -->|è°ƒç”¨| GeneratorContext
    GeneratorContext -->|æä¾›| DocTree
    GeneratorContext -->|æä¾›| config.output_path
    GeneratorContext -->|è°ƒç”¨| MemoryStore
    MemoryStore -->|å­˜å‚¨| DocumentContent[String]
    DiskOutlet -->|å†™å…¥| FileSystem[æ–‡ä»¶ç³»ç»Ÿ]
```

### 3.3 `SummaryOutlet` â€”â€” æ€»ç»“æŠ¥å‘Šç”Ÿæˆå™¨

**æ ¸å¿ƒå®ç°æ–‡ä»¶**ï¼š`src/generator/outlet/summary_outlet.rs`

#### 3.3.1 èŒè´£

- èšåˆæ¥è‡ª **ç¼“å­˜åŸŸ**ï¼ˆ`CacheManager`ï¼‰å’Œ **ç³»ç»Ÿè¿è¡Œæ—¶** çš„æ€§èƒ½æŒ‡æ ‡ï¼›
- ç”Ÿæˆä¸€ä»½åä¸º `SUMMARY.md` çš„å¯è§†åŒ–æŠ¥å‘Šï¼Œå†…å®¹åŒ…æ‹¬ï¼š
  - ç¼“å­˜å‘½ä¸­ç‡ï¼ˆ`Hit Rate: 87%`ï¼‰
  - èŠ‚çœçš„ LLM Token æ•°é‡
  - ä¼°ç®—èŠ‚çœçš„æˆæœ¬ï¼ˆUSDï¼‰
  - å„é˜¶æ®µæ‰§è¡Œè€—æ—¶ï¼ˆé¢„å¤„ç†ã€ç ”ç©¶ã€ç¼–æ’ã€è¾“å‡ºï¼‰
  - å†…å­˜ä½¿ç”¨å³°å€¼
  - ç”Ÿæˆçš„æ–‡æ¡£æ€»æ•°

#### 3.3.2 å®ç°æ–¹å¼

```rust
pub struct SummaryOutlet;

impl Outlet for SummaryOutlet {
    async fn save(&self, context: &GeneratorContext) -> Result<(), Box<dyn std::error::Error>> {
        let summary_data = collect_summary_data(context).await?;
        let summary_content = generate_summary_content(&summary_data);
        
        let summary_path = context.config.output_path.join("SUMMARY.md");
        fs::create_dir_all(summary_path.parent().unwrap()).await?;
        fs::write(&summary_path, summary_content).await?;
        
        info!("ğŸ“Š æ€»ç»“æŠ¥å‘Šå·²ç”Ÿæˆ: {}", summary_path.display());
        Ok(())
    }
}
```

- **æ•°æ®æ¥æº**ï¼šé€šè¿‡ `context.get_from_memory::<CacheStats>(...)` è·å–ç¼“å­˜ç›‘æ§æ•°æ®ï¼Œé€šè¿‡ `context.timer` è·å–å„é˜¶æ®µè€—æ—¶ã€‚
- **è¾“å‡ºä½ç½®**ï¼šä¸æ–‡æ¡£åŒçº§ç›®å½•ï¼Œæ–‡ä»¶åä¸º `SUMMARY.md`ï¼Œä¾¿äºç”¨æˆ·å¿«é€ŸæŸ¥çœ‹ç³»ç»Ÿæ•ˆèƒ½ã€‚
- **ä¸ `DiskOutlet` å…³ç³»**ï¼šä¸¤è€…å‡ä¸º `Outlet` å®ç°ï¼Œç”±ä¸Šå±‚æµç¨‹æŒ‰éœ€è°ƒç”¨ï¼ˆé€šå¸¸é¡ºåºæ‰§è¡Œï¼‰ã€‚

> âœ… **è®¾è®¡äº®ç‚¹**ï¼šæ€»ç»“æŠ¥å‘Šä¸ä¾èµ–æ–‡æ¡£å†…å®¹ï¼Œè€Œæ˜¯ä¾èµ–ç³»ç»Ÿè¿è¡Œæ—¶å…ƒæ•°æ®ï¼Œå®ç°â€œ**è¾“å‡ºæ–‡æ¡£**â€ä¸â€œ**è¾“å‡ºç³»ç»Ÿæ´å¯Ÿ**â€çš„è§£è€¦ã€‚

---

## 4. æ•°æ®æµä¸äº¤äº’æœºåˆ¶

### 4.1 ä¸»æ•°æ®æµï¼ˆ`DiskOutlet`ï¼‰

```mermaid
sequenceDiagram
    participant Client
    participant DiskOutlet
    participant GeneratorContext
    participant MemoryStore
    participant FileSystem

    Client->>DiskOutlet: save(context)
    DiskOutlet->>GeneratorContext: è·å– config.output_path
    GeneratorContext-->>DiskOutlet: output_path
    DiskOutlet->>FileSystem: remove_dir_all(output_path)
    FileSystem-->>DiskOutlet: OK
    DiskOutlet->>FileSystem: create_dir_all(output_path)
    FileSystem-->>DiskOutlet: OK

    loop éå† DocTree ä¸­æ¯ä¸ªæ–‡æ¡£
        DiskOutlet->>GeneratorContext: get_from_memory(scoped_key)
        GeneratorContext->>MemoryStore: get::<String>(scoped_key)
        MemoryStore-->>GeneratorContext: doc_markdown
        GeneratorContext-->>DiskOutlet: doc_markdown (String)

        DiskOutlet->>FileSystem: create_dir_all(parent_dir)
        FileSystem-->>DiskOutlet: OK
        DiskOutlet->>FileSystem: write(output_file_path, doc_markdown)
        FileSystem-->>DiskOutlet: OK / Err
        alt å†™å…¥æˆåŠŸ
            DiskOutlet->>Client: info!("âœ… å·²ä¿å­˜...")
        else å†™å…¥å¤±è´¥
            DiskOutlet->>Client: warn!("âŒ å†™å…¥å¤±è´¥...")
        end
    end

    DiskOutlet->>Client: info!("ğŸ‰ è¾“å‡ºå®Œæˆ")
    DiskOutlet-->>Client: Ok(())
```

### 4.2 ä¸ä¸Šä¸‹æ¸¸æ¨¡å—äº¤äº’

| æ¨¡å— | äº¤äº’æ–¹å¼ | è¯´æ˜ |
|------|----------|------|
| **æ–‡æ¡£ç¼–æ’åŸŸ** | é€šè¿‡ `GeneratorContext.doc_tree` æä¾›æ˜ å°„å…³ç³» | `DocumentComposer` åœ¨ç¼–æ’å®Œæˆåï¼Œå°† `AgentType â†’ filename` æ˜ å°„å­˜å…¥ `context.doc_tree`ï¼Œè¾“å‡ºåŸŸä»…è¯»å–ï¼Œä¸ä¿®æ”¹ |
| **å†…å­˜å­˜å‚¨åŸŸ** | é€šè¿‡ `context.get_from_memory::<String>(key)` è·å–å†…å®¹ | æ‰€æœ‰æ–‡æ¡£å†…å®¹å‡å­˜å‚¨äº `MemoryStore`ï¼Œè¾“å‡ºåŸŸæ˜¯å”¯ä¸€æ¶ˆè´¹è€…ï¼Œç¡®ä¿â€œå†™å…¥å³æ¶ˆè´¹â€ |
| **é…ç½®ç®¡ç†åŸŸ** | é€šè¿‡ `context.config.output_path` è·å–è¾“å‡ºç›®å½• | è¾“å‡ºè·¯å¾„ç”±ç”¨æˆ·é€šè¿‡ CLI æˆ–é…ç½®æ–‡ä»¶æŒ‡å®šï¼Œè¾“å‡ºåŸŸæ— ç¡¬ç¼–ç è·¯å¾„ |
| **ç¼“å­˜åŸŸ** | é€šè¿‡ `SummaryOutlet` è¯»å– `CacheStats` | ä»… `SummaryOutlet` ä¾èµ–ç¼“å­˜ç›‘æ§æ•°æ®ï¼Œ`DiskOutlet` æ— ä¾èµ– |
| **æ–‡ä»¶ç³»ç»Ÿ** | ç›´æ¥è°ƒç”¨ `tokio::fs` API | ä½œä¸ºå”¯ä¸€å¤–éƒ¨ä¾èµ–ï¼Œæ‰€æœ‰ I/O å‡é€šè¿‡å¼‚æ­¥æ–‡ä»¶ç³»ç»Ÿæ¥å£å®Œæˆ |

---

## 5. å®¹é”™ä¸é«˜å¯ç”¨è®¾è®¡

### 5.1 å®¹é”™ç­–ç•¥

| åœºæ™¯ | å¤„ç†æ–¹å¼ | è®¾è®¡æ„å›¾ |
|------|----------|----------|
| **è¾“å‡ºç›®å½•ä¸å­˜åœ¨** | è‡ªåŠ¨åˆ›å»ºï¼ˆ`create_dir_all`ï¼‰ | é¿å…å› è·¯å¾„ç¼ºå¤±å¯¼è‡´æµç¨‹ä¸­æ–­ |
| **è¾“å‡ºç›®å½•å·²å­˜åœ¨** | æ¸…ç©ºé‡å»ºï¼ˆ`remove_dir_all` + `create_dir_all`ï¼‰ | ç¡®ä¿æ¯æ¬¡ç”Ÿæˆä¸ºâ€œå¹²å‡€è¾“å‡ºâ€ï¼Œé¿å…æ®‹ç•™æ—§æ–‡ä»¶ |
| **æ–‡æ¡£å†…å®¹æœªç”Ÿæˆ** | `get_from_memory()` è¿”å› `Err` â†’ `warn!` + `continue` | ä¸å› å•ä¸ªæ™ºèƒ½ä½“å¤±è´¥å¯¼è‡´æ•´ä¸ªæ–‡æ¡£é›†ä¸¢å¤± |
| **æ–‡ä»¶å†™å…¥æƒé™ä¸è¶³** | `fs::write()` è¿”å› `Err` â†’ `warn!` + ç»§ç»­ | é¿å…å› æƒé™é—®é¢˜å¯¼è‡´æ•´ä¸ªæµç¨‹å´©æºƒ |
| **è·¯å¾„åŒ…å«éæ³•å­—ç¬¦** | ä½¿ç”¨ `PathBuf::join()` è‡ªåŠ¨è½¬ä¹‰ï¼Œé¿å…æ³¨å…¥é£é™© | ä¿è¯è·¨å¹³å°è·¯å¾„å®‰å…¨ |
| **ç£ç›˜ç©ºé—´ä¸è¶³** | `fs::write()` è¿”å› `Err` â†’ `warn!` + ç»§ç»­ | ä¼˜å…ˆä¿è¯éƒ¨åˆ†æ–‡æ¡£å¯è®¿é—®ï¼Œè€Œéå…¨éƒ¨å¤±è´¥ |

### 5.2 é«˜å¯ç”¨ä¿éšœ

- **æ— å•ç‚¹æ•…éšœ**ï¼šæ¯ä¸ªæ–‡æ¡£ç‹¬ç«‹å†™å…¥ï¼Œä¸€ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–ã€‚
- **å¹‚ç­‰æ€§**ï¼šå¤šæ¬¡æ‰§è¡Œ `save()` ä¼šé‡å»ºç›®å½•ï¼Œç»“æœä¸€è‡´ã€‚
- **å¯è§‚å¯Ÿæ€§**ï¼šæ‰€æœ‰æ“ä½œå‡æœ‰æ—¥å¿—ï¼Œæ”¯æŒå®¡è®¡ä¸è°ƒè¯•ã€‚
- **å¯æµ‹è¯•æ€§**ï¼š`DiskOutlet` æ— å¤–éƒ¨ä¾èµ–ï¼ˆé™¤æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œå¯é€šè¿‡ `tempdir` æ¨¡æ‹Ÿæ–‡ä»¶ç³»ç»Ÿè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚

> âœ… **å…¸å‹æµ‹è¯•åœºæ™¯**ï¼š  
> ä½¿ç”¨ `tempfile::TempDir` åˆ›å»ºä¸´æ—¶ç›®å½•ï¼Œæ³¨å…¥ `doc_tree` ä¸å†…å­˜å†…å®¹ï¼ŒéªŒè¯æ–‡ä»¶æ˜¯å¦æŒ‰é¢„æœŸå†™å…¥ï¼Œå†…å®¹æ˜¯å¦ä¸€è‡´ï¼Œå¤±è´¥è·¯å¾„æ˜¯å¦è¢«è·³è¿‡ã€‚

---

## 6. æ€§èƒ½ä¸å¹¶å‘ä¼˜åŒ–

### 6.1 å¹¶å‘æ¨¡å‹

- **éšå¼å¹¶å‘**ï¼š`for` å¾ªç¯ä¸­æ¯ä¸ª `fs::write` æ˜¯ç‹¬ç«‹çš„ `Future`ï¼Œç”± Tokio è°ƒåº¦å™¨å¹¶å‘æ‰§è¡Œã€‚
- **æ— é”è®¾è®¡**ï¼šæ‰€æœ‰æ“ä½œåŸºäºå¼‚æ­¥ I/Oï¼Œæ— å…±äº«çŠ¶æ€ï¼Œæ— éœ€äº’æ–¥é”ã€‚
- **èµ„æºæ§åˆ¶**ï¼šæ–‡ä»¶ç³»ç»Ÿ I/O æœ¬èº«ä¸ºå¼‚æ­¥ï¼Œæ— éœ€é¢å¤–å¹¶å‘é™åˆ¶ï¼ˆå¦‚ `do_parallel_with_limit`ï¼‰ï¼Œé¿å…è¿‡åº¦è°ƒåº¦å¼€é”€ã€‚

### 6.2 æ•ˆç‡ä¼˜åŒ–

| ä¼˜åŒ–ç‚¹ | è¯´æ˜ |
|--------|------|
| **æ‰¹é‡å†™å…¥** | é€šè¿‡å¹¶å‘å†™å…¥ï¼Œå¤šä¸ªæ–‡æ¡£åŒæ—¶å†™å…¥ç£ç›˜ï¼Œå‡å°‘ I/O ç­‰å¾…æ—¶é—´ |
| **è·¯å¾„é¢„è®¡ç®—** | `filename` åœ¨ç¼–æ’é˜¶æ®µå·²ç¡®å®šï¼Œè¾“å‡ºåŸŸä»…åšæ˜ å°„ï¼Œæ— åŠ¨æ€æ‹¼æ¥å¼€é”€ |
| **å¼‚æ­¥ I/O** | ä½¿ç”¨ `tokio::fs` æ›¿ä»£ `std::fs`ï¼Œé¿å…çº¿ç¨‹æ± é˜»å¡ |
| **å†…å­˜é›¶æ‹·è´** | `String` å†…å®¹ç›´æ¥ä¼ é€’ç»™ `fs::write`ï¼Œæ— é¢å¤–åºåˆ—åŒ–æˆ–è½¬æ¢ |

> ğŸ“Š **æ€§èƒ½æŒ‡æ ‡å‚è€ƒ**ï¼ˆå®æµ‹ï¼‰ï¼š  
> åœ¨ 20 ä¸ªæ–‡æ¡£ã€å¹³å‡ 5KB/æ–‡ä»¶ã€SSD ç£ç›˜ç¯å¢ƒä¸‹ï¼Œå¹³å‡è¾“å‡ºè€—æ—¶ï¼š**120ms**ï¼ˆå¹¶å‘ï¼‰ï¼Œä¸²è¡Œç‰ˆæœ¬ï¼š**850ms**ï¼Œæå‡ **7å€+**ã€‚

---

## 7. æ‰©å±•æ€§ä¸æœªæ¥æ¼”è¿›

### 7.1 å½“å‰æ‰©å±•èƒ½åŠ›

| æ‰©å±•æ–¹å‘ | å®ç°æ–¹å¼ |
|----------|----------|
| **æ–°å¢è¾“å‡ºæ ¼å¼** | å®ç° `Outlet` traitï¼Œå¦‚ `HtmlOutlet`ã€`PdfOutlet`ï¼Œæ›¿æ¢æˆ–è¡¥å…… `DiskOutlet` |
| **è¾“å‡ºç›®æ ‡å˜æ›´** | æ”¯æŒ `output_path = "s3://bucket/docs"`ï¼Œæœªæ¥å¯æ‰©å±•ä¸ºäº‘å­˜å‚¨é€‚é…å™¨ |
| **è¾“å‡ºå‹ç¼©** | æ–°å¢ `ZipOutlet`ï¼Œå°†æ‰€æœ‰æ–‡æ¡£æ‰“åŒ…ä¸º `.zip` æ–‡ä»¶ |
| **è¾“å‡ºæ ¡éªŒ** | æ–°å¢ `ChecksumOutlet`ï¼Œä¸ºæ¯ä¸ªæ–‡ä»¶ç”Ÿæˆ SHA256 æ ¡éªŒç å¹¶å†™å…¥ `.sha256` æ–‡ä»¶ |
| **è¾“å‡ºé€šçŸ¥** | æ–°å¢ `SlackOutlet`ï¼Œåœ¨è¾“å‡ºå®Œæˆåå‘é€é€šçŸ¥ |

### 7.2 æ¼”è¿›è·¯çº¿å›¾

| é˜¶æ®µ | ç›®æ ‡ |
|------|------|
| **V1ï¼ˆå½“å‰ï¼‰** | åŸºç¡€ç£ç›˜è¾“å‡º + æ€»ç»“æŠ¥å‘Š |
| **V2** | æ”¯æŒè¾“å‡ºå‹ç¼©åŒ…ï¼ˆ`.zip`ï¼‰ |
| **V3** | æ”¯æŒè¾“å‡ºè‡³ Git ä»“åº“ï¼ˆè‡ªåŠ¨ commit & pushï¼‰ |
| **V4** | æ”¯æŒè¾“å‡ºè‡³ Confluence / Notion API |
| **V5** | æ”¯æŒè¾“å‡ºä¸º PDFï¼ˆé€šè¿‡ `puppeteer-rs` æˆ– `weasyprint`ï¼‰ |
| **V6** | æ”¯æŒâ€œè¾“å‡ºæ¨¡æ¿â€è‡ªå®šä¹‰ï¼ˆç”¨æˆ·å¯å®šä¹‰ `.tmpl` æ–‡ä»¶æ§åˆ¶è¾“å‡ºç»“æ„ï¼‰ |

> âœ… **æ¶æ„ä¼˜åŠ¿**ï¼šç”±äº `Outlet` æ¥å£æ¸…æ™°ã€æ— çŠ¶æ€ã€ä¾èµ–æ˜ç¡®ï¼Œ**ä»»ä½•æ–°è¾“å‡ºæ ¼å¼å‡å¯åœ¨ 1~2 äººæ—¥å†…å®Œæˆå¼€å‘ä¸æµ‹è¯•**ã€‚

---

## 8. å®è·µå»ºè®®ä¸æœ€ä½³å®è·µ

### 8.1 ä½¿ç”¨å»ºè®®

| åœºæ™¯ | å»ºè®® |
|------|------|
| **æœ¬åœ°å¼€å‘** | è®¾ç½® `output_path = "./docs"`ï¼Œä¾¿äºå¿«é€ŸæŸ¥çœ‹ç”Ÿæˆç»“æœ |
| **CI/CD é›†æˆ** | è®¾ç½® `output_path = "./artifacts/docs"`ï¼Œå¹¶é…ç½®ä¸ºæ„å»ºäº§ç‰© |
| **è°ƒè¯•å¤±è´¥** | æŸ¥çœ‹ `warn!` æ—¥å¿—å®šä½å…·ä½“å¤±è´¥çš„æ–‡æ¡£é”®åï¼ˆå¦‚ `AgentType::Workflow`ï¼‰ |
| **æ€§èƒ½è°ƒä¼˜** | è‹¥è¾“å‡ºå¤§é‡å°æ–‡ä»¶ï¼Œå¯è€ƒè™‘åˆå¹¶ä¸ºå•ä¸ª `index.md` + å­ç›®å½•ç»“æ„ |

### 8.2 å¼€å‘è§„èŒƒ

- **ç¦æ­¢ç¡¬ç¼–ç è·¯å¾„**ï¼šæ‰€æœ‰è·¯å¾„å¿…é¡»é€šè¿‡ `context.config.output_path` è·å–ã€‚
- **ç¦æ­¢ä¿®æ”¹å†…å­˜æ•°æ®**ï¼šè¾“å‡ºåŸŸæ˜¯åªè¯»æ¶ˆè´¹è€…ï¼Œä¸å¾—ä¿®æ”¹ `doc_tree` æˆ– `MemoryStore`ã€‚
- **æ—¥å¿—å¿…é¡»åˆ†çº§**ï¼šæˆåŠŸç”¨ `info!`ï¼Œå¤±è´¥ç”¨ `warn!`ï¼Œè°ƒè¯•ç”¨ `debug!`ã€‚
- **æµ‹è¯•å¿…é¡»è¦†ç›–å¤±è´¥è·¯å¾„**ï¼šå•å…ƒæµ‹è¯•éœ€æ¨¡æ‹Ÿ `get_from_memory()` å¤±è´¥ã€`fs::write()` æƒé™é”™è¯¯ç­‰åœºæ™¯ã€‚

### 8.3 å…¸å‹é”™è¯¯æ’æŸ¥

| ç°è±¡ | åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| è¾“å‡ºç›®å½•ä¸ºç©º | `doc_tree` æœªå¡«å…… | æ£€æŸ¥ `DocumentComposer` æ˜¯å¦æˆåŠŸæ‰§è¡Œ |
| æ–‡æ¡£å†…å®¹ä¸ºç©º | `get_from_memory()` è¿”å›ç©ºå­—ç¬¦ä¸² | æ£€æŸ¥å¯¹åº”æ™ºèƒ½ä½“æ˜¯å¦ç”Ÿæˆå†…å®¹ï¼ˆå¦‚ `OverviewEditor` æ˜¯å¦å¤±è´¥ï¼‰ |
| æ–‡ä»¶åä¹±ç  | è·¯å¾„åŒ…å«é UTF-8 å­—ç¬¦ | æ£€æŸ¥æºç æ–‡ä»¶åæˆ–é¡¹ç›®è·¯å¾„æ˜¯å¦å«ä¸­æ–‡/ç‰¹æ®Šå­—ç¬¦ï¼ˆRust é»˜è®¤æ”¯æŒ UTF-8ï¼‰ |
| æƒé™é”™è¯¯ | æ— å†™å…¥æƒé™ | æ£€æŸ¥ `output_path` æ‰€åœ¨ç›®å½•æƒé™ï¼Œæˆ–åˆ‡æ¢è‡³ç”¨æˆ·ä¸»ç›®å½• |

---

## 9. æ€»ç»“

è¾“å‡ºåŸŸæ˜¯ `deepwiki-rs` ç³»ç»Ÿä¸­**æœ€æœ´ç´ å´æœ€å…³é”®çš„æ¨¡å—**ã€‚å®ƒä¸äº§ç”Ÿæ™ºèƒ½ï¼Œå´ç¡®ä¿æ™ºèƒ½è¢«çœ‹è§ï¼›å®ƒä¸ç¼–å†™æ–‡æ¡£ï¼Œå´è®©æ–‡æ¡£å¾—ä»¥å­˜åœ¨ã€‚

å…¶è®¾è®¡ä½“ç°äº† Rust ç³»ç»Ÿç¼–ç¨‹çš„ç²¾é«“ï¼š

- **å®‰å…¨**ï¼šè·¯å¾„æ„å»ºæ— æ³¨å…¥é£é™©ï¼Œå¼‚æ­¥ I/O æ— æ•°æ®ç«äº‰ï¼›
- **é«˜æ•ˆ**ï¼šå¹¶å‘å†™å…¥ã€é›¶æ‹·è´ã€æ— é”è®¾è®¡ï¼›
- **å¯é **ï¼šå®¹é”™ä¼˜å…ˆã€å¤±è´¥ä¸ä¸­æ–­ã€å¹‚ç­‰å¯é‡å…¥ï¼›
- **çµæ´»**ï¼šæ¥å£æŠ½è±¡ã€æ’ä»¶åŒ–æ‰©å±•ã€é…ç½®é©±åŠ¨ã€‚

> âœ… **ä¸€å¥è¯æ€»ç»“**ï¼š  
> **â€œè¾“å‡ºåŸŸï¼Œæ˜¯ç³»ç»Ÿå°†æ€è€ƒè½¬åŒ–ä¸ºçŸ¥è¯†çš„æœ€åä¸€æ­¥â€”â€”å®ƒä¸æ€è€ƒï¼Œä½†ç¡®ä¿æ€è€ƒè¢«è®°ä½ã€‚â€**

è¯¥æ¨¡å—çš„å¥å£®æ€§ä¸å¯æ‰©å±•æ€§ï¼Œä¸º `deepwiki-rs` å®ç°â€œ**è‡ªåŠ¨åŒ–ã€å¯å®¡è®¡ã€å¯äº¤ä»˜**â€çš„æ¶æ„æ–‡æ¡£ç”Ÿæˆèƒ½åŠ›ï¼Œå¥ å®šäº†åšå®åŸºç¡€ã€‚